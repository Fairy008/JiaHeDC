<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jh.cltApp.mapping.ICltTaskInfoMapper">
  <resultMap id="BaseResultMap" type="com.jh.cltApp.entity.CltTaskInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="task_id" jdbcType="INTEGER" property="taskId" />
    <result column="data_status" jdbcType="CHAR" property="dataStatus" />
    <result column="del_flag" jdbcType="CHAR" property="delFlag" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="creator_name" jdbcType="VARCHAR" property="creatorName" />
    <result column="creator" jdbcType="INTEGER" property="creator" />
    <result column="modify_time" jdbcType="TIMESTAMP" property="modifyTime" />
    <result column="modifier_name" jdbcType="VARCHAR" property="modifierName" />
    <result column="modifier" jdbcType="INTEGER" property="modifier" />
    <result column="remark" jdbcType="VARCHAR" property="remark" />
    <result column="task_name" jdbcType="VARCHAR" property="taskName" />
    <result column="template_id" jdbcType="INTEGER" property="templateId" />
    <result column="task_type" jdbcType="INTEGER" property="taskType" />
    <result column="crop_id" jdbcType="INTEGER" property="cropId" />
    <result column="purpose" jdbcType="VARCHAR" property="purpose" />
    <result column="start_date" jdbcType="TIMESTAMP" property="startDate" />
    <result column="end_date" jdbcType="TIMESTAMP" property="endDate" />
    <result column="task_flag" jdbcType="INTEGER" property="taskFlag" />
    <result column="index_show" jdbcType="INTEGER" property="indexShow" />
    <result column="index_show_img" jdbcType="VARCHAR" property="indexShowImg" />
    <result column="task_status" jdbcType="INTEGER" property="taskStatus" />
    <result column="is_publish" jdbcType="INTEGER" property="isPublish" />
    <result column="auditor" jdbcType="INTEGER" property="auditor" />
    <result column="audit_time" jdbcType="TIMESTAMP" property="auditTime" />
    <result column="publisher" jdbcType="INTEGER" property="publisher" />
    <result column="publish_time" jdbcType="TIMESTAMP" property="publishTime" />
    <result column="region_id" jdbcType="BIGINT" property="regionId" />
    <result column="company_name" jdbcType="VARCHAR" property="companyName" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    task_id, data_status, del_flag, create_time, creator_name, creator, modify_time,
    modifier_name, modifier, remark, task_name, template_id, task_type, crop_id, purpose,
    start_date, end_date, task_flag, index_show, index_show_img, task_status, is_publish,
    auditor, audit_time, publisher, publish_time, region_id, company_name
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from clt_task_info
    where task_id = #{taskId,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    update clt_task_info set del_flag ='0' where task_id = #{taskId,jdbcType=INTEGER}
  </delete>

  <insert id="insert" parameterType="com.jh.cltApp.entity.CltTaskInfo">
    insert into clt_task_info ( data_status, del_flag,
    create_time, creator_name, creator,
    modify_time, modifier_name, modifier,
    remark, task_name, template_id,
    task_type, crop_id, purpose,
    start_date, end_date, task_flag,
    index_show, index_show_img, task_status,
    is_publish, auditor, audit_time,
    publisher, publish_time, region_id, company_name
    )
    values (#{dataStatus,jdbcType=CHAR}, #{delFlag,jdbcType=CHAR},
    #{createTime,jdbcType=TIMESTAMP}, #{creatorName,jdbcType=VARCHAR}, #{creator,jdbcType=INTEGER},
    #{modifyTime,jdbcType=TIMESTAMP}, #{modifierName,jdbcType=VARCHAR}, #{modifier,jdbcType=INTEGER},
    #{remark,jdbcType=VARCHAR}, #{taskName,jdbcType=VARCHAR}, #{templateId,jdbcType=INTEGER},
    #{taskType,jdbcType=INTEGER}, #{cropId,jdbcType=INTEGER}, #{purpose,jdbcType=VARCHAR},
    #{startDate,jdbcType=DATE}, #{endDate,jdbcType=DATE}, #{taskFlag,jdbcType=INTEGER},
    #{indexShow,jdbcType=INTEGER}, #{indexShowImg,jdbcType=VARCHAR}, #{taskStatus,jdbcType=INTEGER},
    #{isPublish,jdbcType=INTEGER}, #{auditor,jdbcType=INTEGER}, #{auditTime,jdbcType=DATE},
    #{publisher,jdbcType=INTEGER}, #{publishTime,jdbcType=DATE}, #{regionId,jdbcType=BIGINT}, #{companyName,jdbcType=VARCHAR}
    )
  </insert>
  <insert id="insertSelective" parameterType="com.jh.cltApp.entity.CltTaskInfo" useGeneratedKeys="true" keyProperty="taskId" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into clt_task_info
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <!--<if test="taskId != null">
        task_id,
      </if>-->
      <if test="dataStatus != null">
        data_status,
      </if>
      <if test="delFlag != null">
        del_flag,
      </if>
      <!--<if test="createTime != null">-->
      create_time,
      <!--</if>-->
      <if test="creatorName != null">
        creator_name,
      </if>
      <if test="creator != null">
        creator,
      </if>
      <!--<if test="modifyTime != null">-->
      modify_time,
      <!--</if>-->
      <if test="modifierName != null">
        modifier_name,
      </if>
      <if test="modifier != null">
        modifier,
      </if>
      <if test="remark != null">
        remark,
      </if>
      <if test="taskName != null">
        task_name,
      </if>
      <if test="templateId != null">
        template_id,
      </if>
      <if test="taskType != null">
        task_type,
      </if>
      <if test="cropId != null">
        crop_id,
      </if>
      <if test="purpose != null">
        purpose,
      </if>
      <if test="startDate != null">
        start_date,
      </if>
      <if test="endDate != null">
        end_date,
      </if>
      <if test="taskFlag != null">
        task_flag,
      </if>
      <if test="indexShow != null">
        index_show,
      </if>
      <if test="indexShowImg != null">
        index_show_img,
      </if>
      <if test="taskStatus != null">
        task_status,
      </if>
      <if test="isPublish != null">
        is_publish,
      </if>
      <if test="auditor != null">
        auditor,
      </if>
      <if test="auditTime != null">
        audit_time,
      </if>
      <if test="publisher != null">
        publisher,
      </if>
      <if test="publishTime != null">
        publish_time,
      </if>
      <if test="regionId != null">
        region_id,
      </if>
      <if test="regionCode != null">
        region_code,
      </if>
      <if test="companyName != null">
        company_name,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <!--<if test="taskId != null">
        #{taskId,jdbcType=INTEGER},
      </if>-->
      <if test="dataStatus != null">
        #{dataStatus,jdbcType=CHAR},
      </if>
      <if test="delFlag != null">
        #{delFlag,jdbcType=CHAR},
      </if>
      <!--<if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>-->now(),
      <if test="creatorName != null">
        #{creatorName,jdbcType=VARCHAR},
      </if>
      <if test="creator != null">
        #{creator,jdbcType=INTEGER},
      </if>
      <!--<if test="modifyTime != null">
        #{modifyTime,jdbcType=TIMESTAMP},
      </if>-->now(),
      <if test="modifierName != null">
        #{modifierName,jdbcType=VARCHAR},
      </if>
      <if test="modifier != null">
        #{modifier,jdbcType=INTEGER},
      </if>
      <if test="remark != null">
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="taskName != null">
        #{taskName,jdbcType=VARCHAR},
      </if>
      <if test="templateId != null">
        #{templateId,jdbcType=INTEGER},
      </if>
      <if test="taskType != null">
        #{taskType,jdbcType=INTEGER},
      </if>
      <if test="cropId != null">
        #{cropId,jdbcType=INTEGER},
      </if>
      <if test="purpose != null">
        #{purpose,jdbcType=VARCHAR},
      </if>
      <if test="startDate != null">
        #{startDate,jdbcType=DATE},
      </if>
      <if test="endDate != null">
        #{endDate,jdbcType=DATE},
      </if>
      <if test="taskFlag != null">
        #{taskFlag,jdbcType=INTEGER},
      </if>
      <if test="indexShow != null">
        #{indexShow,jdbcType=INTEGER},
      </if>
      <if test="indexShowImg != null">
        #{indexShowImg,jdbcType=VARCHAR},
      </if>
      <if test="taskStatus != null">
        #{taskStatus,jdbcType=INTEGER},
      </if>
      <if test="isPublish != null">
        #{isPublish,jdbcType=INTEGER},
      </if>
      <if test="auditor != null">
        #{auditor,jdbcType=INTEGER},
      </if>
      <if test="auditTime != null">
        #{auditTime,jdbcType=DATE},
      </if>
      <if test="publisher != null">
        #{publisher,jdbcType=INTEGER},
      </if>
      <if test="publishTime != null">
        #{publishTime,jdbcType=DATE},
      </if>
      <if test="regionId != null">
        #{regionId,jdbcType=BIGINT},
      </if>
      <if test="regionCode != null">
        #{regionCode,jdbcType=VARCHAR},
      </if>
        <if test="companyName != null">
            #{companyName,jdbcType=VARCHAR},
        </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.jh.cltApp.entity.CltTaskInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update clt_task_info
    <set>
      <if test="dataStatus != null">
        data_status = #{dataStatus,jdbcType=CHAR},
      </if>
      <if test="delFlag != null">
        del_flag = #{delFlag,jdbcType=CHAR},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="creatorName != null">
        creator_name = #{creatorName,jdbcType=VARCHAR},
      </if>
      <if test="creator != null">
        creator = #{creator,jdbcType=INTEGER},
      </if>
      <!--<if test="modifyTime != null">
        modify_time = #{modifyTime,jdbcType=TIMESTAMP},
      </if>-->modify_time = now(),
      <if test="modifierName != null">
        modifier_name = #{modifierName,jdbcType=VARCHAR},
      </if>
      <if test="modifier != null">
        modifier = #{modifier,jdbcType=INTEGER},
      </if>
      <if test="remark != null">
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="taskName != null">
        task_name = #{taskName,jdbcType=VARCHAR},
      </if>
      <if test="templateId != null">
        template_id = #{templateId,jdbcType=INTEGER},
      </if>
      <if test="taskType != null">
        task_type = #{taskType,jdbcType=INTEGER},
      </if>
      <if test="cropId != null">
        crop_id = #{cropId,jdbcType=INTEGER},
      </if>
      <if test="purpose != null">
        purpose = #{purpose,jdbcType=VARCHAR},
      </if>
      <if test="startDate != null">
        start_date = #{startDate,jdbcType=DATE},
      </if>
      <if test="endDate != null">
        end_date = #{endDate,jdbcType=DATE},
      </if>
      <if test="taskFlag != null">
        task_flag = #{taskFlag,jdbcType=INTEGER},
      </if>
      <if test="indexShow != null">
        index_show = #{indexShow,jdbcType=INTEGER},
      </if>
      <if test="indexShowImg != null">
        index_show_img = #{indexShowImg,jdbcType=VARCHAR},
      </if>
      <if test="taskStatus != null">
        task_status = #{taskStatus,jdbcType=INTEGER},
      </if>
      <if test="isPublish != null">
        is_publish = #{isPublish,jdbcType=INTEGER},
      </if>
      <if test="auditor != null">
        auditor = #{auditor,jdbcType=INTEGER},
      </if>
      <if test="auditTime != null">
        audit_time = #{auditTime,jdbcType=DATE},
      </if>
      <if test="publisher != null">
        publisher = #{publisher,jdbcType=INTEGER},
      </if>
      <if test="publishTime != null">
        publish_time = #{publishTime,jdbcType=DATE},
      </if>
      <if test="regionId != null">
        region_id = #{regionId,jdbcType=BIGINT},
      </if>
      <if test="regionCode != null">
        region_code = #{regionCode,jdbcType=VARCHAR},
      </if>
        <if test="companyName != null">
            company_name = #{companyName,jdbcType=VARCHAR},
        </if>
    </set>
    where task_id = #{taskId,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.jh.cltApp.entity.CltTaskInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update clt_task_info
    set data_status = #{dataStatus,jdbcType=CHAR},
    del_flag = #{delFlag,jdbcType=CHAR},
    create_time = #{createTime,jdbcType=TIMESTAMP},
    creator_name = #{creatorName,jdbcType=VARCHAR},
    creator = #{creator,jdbcType=INTEGER},
    modify_time = #{modifyTime,jdbcType=TIMESTAMP},
    modifier_name = #{modifierName,jdbcType=VARCHAR},
    modifier = #{modifier,jdbcType=INTEGER},
    remark = #{remark,jdbcType=VARCHAR},
    task_name = #{taskName,jdbcType=VARCHAR},
    template_id = #{templateId,jdbcType=INTEGER},
    task_type = #{taskType,jdbcType=INTEGER},
    crop_id = #{cropId,jdbcType=INTEGER},
    purpose = #{purpose,jdbcType=VARCHAR},
    start_date = #{startDate,jdbcType=DATE},
    end_date = #{endDate,jdbcType=DATE},
    task_flag = #{taskFlag,jdbcType=INTEGER},
    index_show = #{indexShow,jdbcType=INTEGER},
    index_show_img = #{indexShowImg,jdbcType=VARCHAR},
    task_status = #{taskStatus,jdbcType=INTEGER},
    is_publish = #{isPublish,jdbcType=INTEGER},
    auditor = #{auditor,jdbcType=INTEGER},
    audit_time = #{auditTime,jdbcType=DATE},
    publisher = #{publisher,jdbcType=INTEGER},
    publish_time = #{publishTime,jdbcType=DATE},
    region_id = #{regionId,jdbcType=BIGINT},
      company_name = #{companyName,jdbcType=VARCHAR}
    where task_id = #{taskId,jdbcType=INTEGER}
  </update>

  <select id="findCltTaskInfoList" parameterType="com.jh.cltApp.entity.CltTaskInfo" resultType="com.jh.cltApp.vo.CltTaskInfoVO">
    select
    f.task_id as taskId,
    f.data_status as dataStatus,
    f.del_flag as delFlag,
    f.create_time as createTime,
    f.creator_name as creatorName,
    f.creator as creator,
    f.modify_time as modifyTime,
    f.modifier_name as modifieName,
    f.modifier as modifier,
    f.remark as remark,
    f.task_name as taskName,
    f.template_id as templateId,
    f.task_type as taskType,
    f.crop_id as cropId,
    f.purpose as purpose,
    f.start_date as startDate,
    f.end_date as endDate,
    f.task_flag as taskFlag,
    f.index_show as indexShow,
    f.index_show_img as indexShowImg,
    f.task_status as taskStatus,
    f.is_publish as isPublish,
    f.auditor as auditor,
    f.audit_time as auditTime,
    f.publisher as publisher,
    f.publish_time as publishTime,
    f.region_id as regionId,
      f.company_name as companyName,
    u.account_id as accountId,
    u.is_shoulder as isShoulder
    from clt_task_info f
    left join clt_task_user u
    on f.task_id = u.task_id
    where u.account_id = #{creator,jdbcType=INTEGER} and f.del_flag ='1' and article_status = 12004
    <if test="taskStatus != null" >
      and task_status = #{taskStatus,jdbcType=INTEGER}
    </if>
    order by f.task_status asc,f.is_publish asc, f.modify_time desc
  </select>

  <select id="findShareCltTaskInfoPageInfo" resultMap="BaseResultMap" parameterType="com.jh.cltApp.entity.CltTaskInfo">
    select
      <include refid="Base_Column_List" />
    from clt_task_info
    where creator = #{cltTaskInfo.creator,jdbcType=INTEGER}
    and is_publish IN
    <foreach collection="isPublishArr" index="index" item="item" separator="," open="(" close=")">
      #{item, jdbcType=INTEGER}
    </foreach>
    and del_flag ='1'
  </select>

  <!--查询任务列表-->
  <select id="getListByCombination" resultMap="BaseResultMap" parameterType="com.jh.cltApp.entity.CltTaskInfo">
    select
      <include refid="Base_Column_List" />
    from clt_task_info where del_flag ='1'
      <if test="dataStatus != null and dataStatus != ''">
        and data_status = #{dataStatus,jdbcType=CHAR}
      </if>
      <if test="delFlag != null and delFlag != ''">
        and del_flag = #{delFlag,jdbcType=CHAR}
      </if>
      <if test="createTime != null">
        and create_time = #{createTime,jdbcType=TIMESTAMP}
      </if>
      <if test="creatorName != null and creatorName !=''">
        and creator_name = #{creatorName,jdbcType=VARCHAR}
      </if>
      <if test="creator != null">
        and creator = #{creator,jdbcType=INTEGER}
      </if>
      <if test="modifyTime != null">
        and modify_time = #{modifyTime,jdbcType=TIMESTAMP}
      </if>
      <if test="modifierName != null and modifierName !=''">
        and modifier_name = #{modifierName,jdbcType=VARCHAR}
      </if>
      <if test="modifier != null">
        and modifier = #{modifier,jdbcType=INTEGER}
      </if>
      <if test="remark != null and remark != ''">
        and remark = #{remark,jdbcType=VARCHAR}
      </if>
      <if test="taskName != null and taskName !=''">
        and task_name = #{taskName,jdbcType=VARCHAR}
      </if>
      <if test="templateId != null">
        and template_id = #{templateId,jdbcType=INTEGER}
      </if>
      <if test="taskType != null">
        and task_type = #{taskType,jdbcType=INTEGER}
      </if>
      <if test="cropId != null">
        and crop_id = #{cropId,jdbcType=INTEGER}
      </if>
      <if test="purpose != null and purpose !=''">
        and purpose = #{purpose,jdbcType=VARCHAR}
      </if>
      <if test="startDate != null">
        and start_date = #{startDate,jdbcType=DATE}
      </if>
      <if test="endDate != null">
        and end_date = #{endDate,jdbcType=DATE}
      </if>
      <if test="taskFlag != null">
        and task_flag = #{taskFlag,jdbcType=INTEGER}
      </if>
      <if test="indexShow != null">
        and index_show = #{indexShow,jdbcType=INTEGER}
      </if>
      <if test="indexShowImg != null and indexShowImg !=''">
        and index_show_img = #{indexShowImg,jdbcType=VARCHAR}
      </if>
      <if test="taskStatus != null">
        and task_status = #{taskStatus,jdbcType=INTEGER}
      </if>
      <if test="isPublish != null">
        and is_publish = #{isPublish,jdbcType=INTEGER}
      </if>
      <if test="auditor != null">
        and auditor = #{auditor,jdbcType=INTEGER}
      </if>
      <if test="auditTime != null">
        and audit_time = #{auditTime,jdbcType=DATE}
      </if>
      <if test="publisher != null">
        and publisher = #{publisher,jdbcType=INTEGER}
      </if>
      <if test="publishTime != null">
        and publish_time = #{publishTime,jdbcType=DATE}
      </if>
      <if test="regionId != null">
        and region_id = #{regionId,jdbcType=BIGINT}
      </if>
        <if test="companyName != null">
           and company_name = #{companyName,jdbcType=VARCHAR}
        </if>
  </select>

    <select id="getCltTaskInfoByTaskId" parameterType="java.lang.Integer" resultType="com.jh.cltApp.vo.CltTaskInfoVO">
        select
            f.task_id as taskId,
            f.data_status as dataStatus,
            f.del_flag as delFlag,
            f.create_time as createTime,
            f.creator_name as creatorName,
            f.creator as creator,
            f.modify_time as modifyTime,
            f.modifier_name as modifieName,
            f.modifier as modifier,
            f.remark as remark,
            f.task_name as taskName,
            f.template_id as templateId,
            (select template_name from clt_template where template_id = f.template_id) as templateName,
            f.task_type as taskType,
            f.crop_id as cropId,
            f.purpose as purpose,
            f.start_date as startDate,
            f.end_date as endDate,
            f.task_flag as taskFlag,
            f.index_show as indexShow,
            f.index_show_img as indexShowImg,
            f.task_status as taskStatus,
            f.is_publish as isPublish,
            f.auditor as auditor,
            f.audit_time as auditTime,
            f.publisher as publisher,
            f.publish_time as publishTime,
            f.region_id as regionId,
            f.region_code as regioncode,
            f.company_name as companyName
        from clt_task_info f
        where task_id = #{taskId,jdbcType=INTEGER} and f.del_flag ='1'
    </select>
  <!--后台分页查询-->
  <select id="findCltTaskInfoListCms" parameterType="com.jh.cltApp.entity.CltTaskInfo" resultType="com.jh.cltApp.vo.CltTaskInfoVO">
    select
    f.task_id as taskId,
    f.data_status as dataStatus,
    f.del_flag as delFlag,
    f.create_time as createTime,
    f.creator_name as creatorName,
    f.creator as creator,
    f.modify_time as modifyTime,
    f.modifier_name as modifieName,
    f.modifier as modifier,
    f.task_name as taskName,
    f.template_id as templateId,
    f.task_type as taskType,
    f.crop_id as cropId,
    f.purpose as purpose,
    f.start_date as startDate,
    f.end_date as endDate,
    f.task_flag as taskFlag,
    f.index_show as indexShow,
    f.index_show_img as indexShowImg,
    f.task_status as taskStatus,
    f.is_publish as isPublish,
    f.auditor as auditor,
    f.audit_time as auditTime,
    f.publisher as publisher,
    f.publish_time as publishTime,
    f.region_id as regionId,
    f.company_name as companyName,
    (select count(1) from clt_task_item where del_flag = '1' and task_id = f.task_id) as itemCount
    from
    ( select
    t.*,array_to_string(array_agg(u.account_id||''),',') as accountIds
    from clt_task_info t left join clt_task_user u on t.task_id = u.task_id
    GROUP BY t.task_id ) f
    where del_flag ='1'
    <if test="creator != null" >
      and position(#{creator,jdbcType=INTEGER}||'' in  f.accountIds) > 0
    </if>
    <if test="taskName != null and taskName != '' ">
      AND task_name like CONCAT('%',#{taskName,jdbcType=VARCHAR},'%')
    </if>
    <if test="taskType != null" >
      and task_type = #{taskType,jdbcType=INTEGER}
    </if>
    <if test="cropId != null" >
      and crop_id = #{cropId,jdbcType=INTEGER}
    </if>
    <if test="regionId != null" >
      and region_id = #{regionId,jdbcType=INTEGER}
    </if>
    <if test="regionCode != null and regionCode != '' ">
      AND region_code like CONCAT('%',#{regionCode,jdbcType=VARCHAR},'%')
    </if>
    <if test="taskStatus != null" >
      and task_status = #{taskStatus,jdbcType=INTEGER}
    </if>
    <if test="isPublish != null" >
      and is_publish = #{isPublish,jdbcType=INTEGER}
    </if>
    <if test="indexShow != null" >
      and index_show = #{indexShow,jdbcType=INTEGER}
    </if>
    <if test="creatorName != null and creatorName != '' ">
      AND creator_name like CONCAT('%',#{creatorName,jdbcType=VARCHAR},'%')
    </if>
    <if test="startCreateTime != null and startCreateTime != '' and endCreateTime != null and endCreateTime != ''">
      AND create_time BETWEEN CAST((#{startCreateTime} || ' 00:00:00') AS  TIMESTAMP)AND CAST((#{endCreateTime} || ' 23:59:59') AS TIMESTAMP)
    </if>
    <if test="isPublishList != null" >
      and is_publish in
      <foreach collection="isPublishList" item="id" separator="," open="(" close=")">
        #{id}
      </foreach>
    </if>

    ORDER BY
    <choose>
      <when test="sidx != null and sidx != ''">
        ${sidx} ${sord}
      </when>
      <otherwise>
        is_publish = 22002 DESC ,is_publish, create_time DESC
      </otherwise>
    </choose>
  </select>

  <update id="auditTaskList" parameterType="com.jh.cltApp.entity.CltTaskInfo">
    update clt_task_info
    <set>
      <if test="dataStatus != null">
        data_status = #{dataStatus,jdbcType=CHAR},
      </if>
      <if test="delFlag != null">
        del_flag = #{delFlag,jdbcType=CHAR},
      </if>
        modify_time = now(),
      <if test="modifierName != null">
        modifier_name = #{modifierName,jdbcType=VARCHAR},
      </if>
      <if test="modifier != null">
        modifier = #{modifier,jdbcType=INTEGER},
      </if>
      <if test="remark != null">
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="taskName != null">
        task_name = #{taskName,jdbcType=VARCHAR},
      </if>
      <if test="templateId != null">
        template_id = #{templateId,jdbcType=INTEGER},
      </if>
      <if test="taskType != null">
        task_type = #{taskType,jdbcType=INTEGER},
      </if>
      <if test="cropId != null">
        crop_id = #{cropId,jdbcType=INTEGER},
      </if>
      <if test="purpose != null">
        purpose = #{purpose,jdbcType=VARCHAR},
      </if>
      <if test="startDate != null">
        start_date = #{startDate,jdbcType=DATE},
      </if>
      <if test="endDate != null">
        end_date = #{endDate,jdbcType=DATE},
      </if>
      <if test="taskFlag != null">
        task_flag = #{taskFlag,jdbcType=INTEGER},
      </if>
      <if test="indexShow != null">
        index_show = #{indexShow,jdbcType=INTEGER},
      </if>
      <if test="indexShowImg != null">
        index_show_img = #{indexShowImg,jdbcType=VARCHAR},
      </if>
      <if test="taskStatus != null">
        task_status = #{taskStatus,jdbcType=INTEGER},
      </if>
      <if test="isPublish != null">
        is_publish = #{isPublish,jdbcType=INTEGER},
      </if>
      <if test="auditor != null">
        auditor = #{auditor,jdbcType=INTEGER},
      </if>
      <if test="auditTime != null">
        audit_time = #{auditTime,jdbcType=DATE},
      </if>
      <if test="publisher != null">
        publisher = #{publisher,jdbcType=INTEGER},
      </if>
      <if test="publishTime != null">
        publish_time = #{publishTime,jdbcType=DATE},
      </if>
      <if test="regionId != null">
        region_id = #{regionId,jdbcType=BIGINT},
      </if>
      <if test="regionCode != null">
        region_code = #{regionCode,jdbcType=VARCHAR},
      </if>
      <if test="companyName != null">
        company_name = #{companyName,jdbcType=VARCHAR},
      </if>
    </set>
    where task_id in
    <foreach collection="taskIds" item="id" separator="," open="(" close=")">
      #{id}
    </foreach>
  </update>

  <!--前台分页查询-->
  <select id="findCltTaskInfoListBbs" parameterType="com.jh.cltApp.entity.CltTaskInfo" resultType="com.jh.cltApp.entity.CltTaskInfo">
    select
    f.task_id as taskId,
    f.task_name as taskName,
    f.task_type as taskType,
    f.crop_id as cropId,
    f.start_date as startDate,
    f.end_date as endDate,
    f.task_status as taskStatus,
    f.is_publish as isPublish,
    f.region_id as regionId
    from
    ( select
    t.*,array_to_string(array_agg(u.account_id||''),',') as accountIds
    from clt_task_info t left join clt_task_user u on t.task_id = u.task_id
    GROUP BY t.task_id ) f
    where del_flag ='1'
    <if test="creator != null" >
      and position(#{creator,jdbcType=INTEGER}||'' in  f.accountIds) > 0
    </if>
    <if test="cropId != null" >
      and crop_id = #{cropId,jdbcType=INTEGER}
    </if>
    <if test="taskStatus != null" >
      and task_status = #{taskStatus,jdbcType=INTEGER}
    </if>
    <if test="isPublishList != null" >
      and is_publish in
      <foreach collection="isPublishList" item="id" separator="," open="(" close=")">
        #{id}
      </foreach>
    </if>

    ORDER BY
    <choose>
      <when test="sidx != null and sidx != ''">
        ${sidx} ${sord}
      </when>
      <otherwise>
        is_publish = 22002 DESC ,is_publish,task_status, create_time DESC
      </otherwise>
    </choose>
  </select>
</mapper>