<style type="text/css">
    #view_orderDescription{
        resize: none;
        border: 1px solid #ededed;
        border-radius: 5px;
    }
    .form table .order_td1{
        width: 30%;
        text-align: left;
    }
    .form table .order_td2{
        width: 90%;
        text-align: center;
    }
    .viewType2{
        border-radius: 5px;
        resize: none;
    }
    .formErrorInfo {
        margin-top: 0px !important;
        padding-left: 20px !important;
    }
    #view_dataPath,#view_handleSuggestion,#view_auditSuggestion{
        color: #0b0b0b;
        overflow:hidden;text-overflow:ellipsis;white-space:nowrap;
    }
    .gragBtn{
        cursor: Default !important;
    }

    .DetailInfo table .four_td1{width: 80px !important;text-align:right;padding-right:2px;}

    .DetailInfo table .four_td2{text-align: left;padding-right:20px;width: calc((100% - 306px)/3) !important;}
    .DetailInfo{margin: auto;background:#FAFAFA !important; border:1px solid #F3F3F3;}
    .DetailInfo table{width:100%;text-align: center !important; }
    .DetailInfo tr td{word-wrap: break-word;text-overflow: ellipsis;white-space: nowrap;overflow: hidden;display: inline-block;height: 24px; line-height: 24px;}

    .DetailInfo table .mul_td1{width:calc(100% - 82px) !important;text-align:left;}
    h3{font-weight:normal;padding-top:10px;}

    .file>div:nth-child(1){width:3%;text-align: left;}
    .file>div:nth-child(2){width:73%;text-align: left;}
    .file>div:nth-child(3){width:20%;text-align:right;}

    #data_list{
        height:270px;
    }
    .file img{
        cursor: pointer;
    }

    .statisticsTable{height:110px;width:40%;margin:0 auto;}
    .statisticsTable>h3{text-align:center;height:30px;line-height:30px;font-weight:bold;}
    .statisticsTable #sTable>div{border:1px solid #000;height:26px;line-height:26px;width:100%;}
    .statisticsTable #sTable>div:first-child{border-bottom:0px}
    .statisticsTable #sTable div>span{width:calc(100%/6 - 2px);height:26px;line-height:26px;display:block;float:left;border-right:1px solid #000;text-align:center;}
    .statisticsTable #sTable div>span:last-child{border-right:0px;}


</style>

<div class="content">
    <div class="searchItems">
        <div class="searchRow">
            <div class="searchBGleft" >
                <div>
                    <span class="label2">订单时间：</span>
                    <span><input type="text" class="input inputWidth_190" id="search_createTime" /></span>
                </div>
            </div>
            <div class="searchBGright">
                <input type="button" class="btn " value="查询" id="queryBtn" />
                <!--<input type="button" class="btn " value="导出" id="exportBtn" />-->
            </div>
        </div>
    </div>
    <div class="statisticsTable">
        <h3>订单数据统计</h3>
        <div id="sTable">
        </div>
    </div>

    <div class="grid">
        <table id="orderGrid"></table>
        <div id="pager2"></div>
    </div>
    <div id="orderInfo" style="display:none;">
        <div  id="orderInfoDetail"  class="DetailInfo">
            <table>
                <tr>
                    <td class="four_td1">订单编号:</td>
                    <td class="four_td2">
                        <span id="view_orderCode" class="viewType"></span>
                    </td>
                    <td class="four_td1">订单分类:</td>
                    <td class="four_td2">
                        <span id="view_orderType" class="viewType"></span>
                    </td>
                    <td class="four_td1">订单类型:</td>
                    <td class="four_td2">
                        <span id="view_orderAttribute" class="viewType"></span>
                    </td>
                </tr>
                <tr>
                    <td class="four_td1">订单时间:</td>
                    <td class="four_td2">
                        <span id="view_createTime" class="viewType"></span>
                    </td>
                    <td class="four_td1">申请人:</td>
                    <td class="four_td2">
                        <span id="view_creatorName" class="viewType"></span>
                    </td>
                    <td class="four_td1">订单状态:</td>
                    <td class="four_td2">
                        <span id="view_auditStatus" class="viewType"></span>
                    </td>
                </tr>
                <tr style="text-align:left;">
                    <td class="four_td1 t6" style="vertical-align: top;">订单需求:</td>
                    <td  colspan="5" style="width:760px;text-align:left;height: 55px !important;" class="t6">
                        <textarea id="view_orderDescription" style="width:99.8% !important;background: #FAFAFA !important" rows="3" disabled></textarea>
                    </td>
                </tr>
                <tr><td class="four_td1" colspan="3" >数据申请单:</td>
                    <td class="four_td2" colspan="3" style="width: calc((93.5% - 82px)) !important;">
                        <span id="word_path" class="viewType word_path" order-id="" data-url="" style="cursor: pointer;color: blue"></span>
                    </td>
                </tr>
            </table>
        </div>

        <div class="fileListDiv" >
            <div class='file_title file'><div id="fileCheckBox" style="margin-left: -6px;display:none;"><input type="checkbox" id="selectAll" name="all" value="all" /></div><div style='text-align: center;' class='fileName'>文件名</div><div class='fileSize'>文件大小</div><div id="downLoadDiv" style="display:none;float: right !important;">操作</div></div>
            <div class="file_list" id="data_list"></div>
        </div>

        <div class="file_list" style="display: none; margin-bottom: 5px;margin-top: -5px;"><input type='button' value='批量下载' class='btn btn_grey' id='batchDownloadBtn' style="float: left;"></div>

        <div  id="orderInfoDetailBot"  class="DetailInfo">
            <table>
                <tr>
                    <td class="four_td1">审核人:</td>
                    <td class="four_td2">
                        <span id="view_orderAuditorName" class="viewType"></span>
                    </td>
                    <td class="four_td1">审核时间:</td>
                    <td class="four_td2">
                        <span id="view_auditTime" class="viewType"></span>
                    </td>
                    <td class="four_td1" >审核意见:</td>
                    <td class="four_td2">
                        <span id="view_auditSuggestion" class="viewType"></span>
                    </td>
                </tr>
                <tr>
                    <td class="four_td1">分发人:</td>
                    <td class="four_td2">
                        <span id="view_handlerPersonName" class="viewType"></span>
                    </td>
                    <td class="four_td1">分发时间:</td>
                    <td class="four_td2">
                        <span id="view_handleTime" class="viewType"></span>
                    </td>
                    <td class="four_td1">分发意见:</td>
                    <td class="four_td2">
                        <span id="view_handleSuggestion" class="viewType"></span>
                    </td>
                </tr>
                <tr style="text-align:left;">
                    <td class="four_td1">有效期:</td>
                    <td class="four_td2"  colspan="5">
                        <span id="view_dataAccessTime" class="viewType" style="width:760px;"></span>
                    </td>
                </tr>
                <tr style="text-align:left;">
                    <td class="four_td1 t5">数据路径:</td>
                    <td colspan="5" class="t5">
                        <span id="view_dataPath" style="width:660px;"></span>
                        <!--1px的input text区域，为js复制使用 2018-04-13-->
                        <input type="text" id="dataPath_hidden" style="height:1px ;width:1px ;border:0 !important;color:#FAFAFA;">
                        <span class="btn btn1 copyBtn" >复制</span><span id="copyTip" style="color:red;padding-left:2px;"></span>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <div id="orderQueryDialog" style="display:none;font-size: 14px" ></div>
    <script>
        require(["jquery","jqGrid","jqueryUi","dateUtil","BaseAjax","formVerfication","PopWin","commons"],function($,jqGrid,jqueryUi,dateUtil, BaseAjax,formVerfication,PopWin,commons){
            var init = function(){

                //初始化日期控件
                dateFun();

                //初始化表格，根据用户类型加载表格，1为内部用户，2为外部用户
                initTable();

                //绑定订单按钮查询
                $("#queryBtn").bind("click",searchFun);
                // $("#exportBtn").bind("click", exportFun);


                $(window).resize(function(){
                    $("#orderGrid").setGridWidth($(".rightMain").width() - 30);
                    chanageTableCss();
                });
                chanageTableCss();
                initSelect();
            };


            var exportFun = function(){

            }

            /**
             *  初始化加载下拉框内容
             * @version  <1> 2018-03-06 cxw : Created.:
             */
            var initSelect =  function () {
                initDistributeStatusSelect();
            };

            /**
             *  根据字典ID获取字典名称，加载审核状态
             * @version  <1> 2018-03-27 cxw : Created.:
             */
                //  审核状态全局变量
            var auditStatusArr = [];
            var getAuditStatus =  function (dictId) {
                var auditStatus;
                for(var i =0;i<auditStatusArr.length;i++)
                {
                    if(auditStatusArr[i][dictId])
                        auditStatus = auditStatusArr[i][dictId];
                }
                return auditStatus;
            };

            /**
             *  初始化根据审核状态编码查询出id，然后根据查询出的id匹配父ID查询出所有字典信息
             * @param dict 字典对象
             * @version  <1> 2018-03-09 cxw : Created.:
             */
            var initDistributeStatusSelect = function () {
                var varyAjax = new BaseAjax();
                varyAjax.opts.url = DICT_COFING.queryDictByCode_url;
                varyAjax.opts.type = "POST";
                varyAjax.opts.async = false; //同步请求
                varyAjax.opts.data = JSON.stringify({'dataCode':'DataAuditType'});
                varyAjax.opts.successFun = function(result){
                    var data = result.data;
                    if(result.flag){
                        if(data.length>0)
                        {
                            for(var i =0 ;i<data.length;i++ ) {
                                var temp = data[i];
                                var tempStatus = {};
                                tempStatus[temp.dictId] = temp.dataName;
                                auditStatusArr[i] = tempStatus;
                            }
                        }
                    }
                };
                varyAjax.opts.errorFun = function(){
                    return false;
                };
                varyAjax.run();
            };

            /**
             * 初始化加载用户订单数据
             * 根据用户类型加载表格，1为内部用户，2为外部用户
             * @param
             * @version  <1> 2018-03-13 cxw : Created.:
             */
            var initTable = function(){
                loaderOrderStatistics({});
                orderGridByInner();
            };

            /**
             * 统计高分数据入库情况
             *
             */
            var loaderOrderStatistics = function(orderParam){

                var ajax = new BaseAjax();
                ajax.opts.url = ORDER_CONFIG.queryOrderStatistics_url;
                ajax.opts.type = "POST";

                $("#sTable").html("")
                $("#sTable a").unbind("click")
                // storageParam.satellites = "GF1,GF2,GF3,GF4"

                ajax.opts.data = JSON.stringify(orderParam);
                ajax.opts.successFun = function (result) {
                    if(result.flag){
                        console.log(result.data)

                        var _th = "<div><span>订单状态</span>"
                        var _td = "<div><span>数量</span>"
                        $.each(result.data,function(index, element){
                            _th += "<span>"+ element.name +"</span>"
                            _td += "<span><a href='javascript:void(0)' value='"+ element.id +"'>"+ element.value +"</a></span>"
                        })
                        _th += "</div>"
                        _td += "</div>"

                        $("#sTable").append(_th).append(_td)
                        //
                        $("#sTable a").bind("click",function(){
                            statisticsHrefClickFun($(this).attr("value"));
                        })

                    }
                };
                ajax.opts.errorFun = function (result) {

                };
                ajax.run();

            }




            /**
             * jqGrid表格控件加载内网用户订单数据
             * @param
             * @version  <1> 2018-03-06 cxw : Created.:
             * @version <2> 2018-04-16 lcw : 根据URL判断是否需要使用“当前登录人ID”进行查询
             */
            var orderGridByInner = function(){
                $("#orderGrid").jqGrid({
                    url: ORDER_CONFIG.findOrderListByPage_url,
                    datatype: "json",
                    postData:{
                    },
                    mtype:'POST',
                    jsonReader: {
                        root: "list",
                        total: "pages",
                        page: "page",
                        records: "total",
                        repeatitems: false
                    },
                    rownumbers: true,
                    colNames:['orderId','申请人ID','订单编号','订单分类','订单类型','申请人', '订单时间', '订单状态', '有效期','数据路径','操作'],
                    colModel:[
                        {name:'orderId',index:'order_id', hidden:true},
                        {name:'creator',index:'creator', hidden:true},
                        {name:'orderCode',index:'order_code',align:'center', width:'10%', sortable:true},
                        {name:'orderType',index:'order_type',align:'center', width:'7%',sortable:true, formatter:function(cellvalue, options, rowObject){
                                var orderType;
                                if(cellvalue==1301) orderType = '数据订单';
                                if(cellvalue==1302) orderType = '需求订单';
                                return orderType;
                            }},
                        {name:'orderAttribute',index:'order_attribute',align:'center', width:'7%',sortable:true, formatter:function(cellvalue, options, rowObject){
                                var orderType = "";
                                if(cellvalue==2101) orderType = '内部订单';
                                if(cellvalue==2102) orderType = '外部订单';

                                return orderType;
                            }},
                        {name:'creatorName',index:'creator_name',align:'center', width:'7%', sortable:true},
                        {name:'createTime',index:'create_time',align:'center', width:'14%', sortable:true},
                        {name:'auditStatus',index:'audit_status', width:'9%', align:"center", sortable:true,formatter:function(cellvalue, options, rowObject){
                                var auditStatus = "";
                                auditStatus = getAuditStatus(cellvalue);
                                return auditStatus;
                            }},
                        {name:'dataAccessTime',index:'data_access_time', width:'12%',align:'center', sortable:true,  formatter: function (cellvalue, options, rowObject) {
                                if(cellvalue==null){
                                    return "";
                                }else if(cellvalue<new Date().Format("yyyy-MM-dd")){
                                    return '<span class="red">' + cellvalue + '</span>';
                                }else{
                                    return cellvalue;
                                }
                                //return cellvalue == null ? "" : new Date(cellvalue).Format("yyyy-MM-dd");
                            }
                        },
                        {name:'dataPath',index:'dataPath', width:'21%',align:'left', sortable:false},
                        {name:'cz',index:'cz', width:'10%',align:"center", sortable:false,formatter:function(cellvalue, options, rowObject){
                                var str='';
                                var auditStatus = rowObject.auditStatus;
                                //未审核状态的需求订单才可编辑和删除
                                // if(auditStatus==1101&&rowObject.orderType==1302) {
                                //     str+= "<img src='images/public/Tedit.png' class='editBtn' data-id='"+ rowObject.orderId +"' title='编辑' >";
                                // }
                                // else {
                                //     str+= "<img src='images/public/TeditG.png'  class='gragBtn' title='编辑' >";
                                // }
                                str += "<img src='images/public/Twatch.png' class='seeBtn' data-id='"+ rowObject.orderId +"' title='订单详情' >";
                                return str;
                            }}
                    ],
                    width:'100%',
                    autowidth:true,
                    height:'100%',
                    rowNum:15,
                    rowList:[15,30],
                    pager: '#pager2',
                    sortname: 'order_id',
                    viewrecords: true,
                    sortorder: "desc",
                    sortable:false,
                    loadComplete:function(){
                        commons.isNextDisable();
                        tableEvent();
                        $("#orderGrid").setGridWidth($(".rightMain").width() - 30);
                    }
                });
            };

            /**
             * 绑定table表格操作事件
             * @version <1> 2017-12-26 lcw : Created.
             */
            var tableEvent = function(){
                $(".seeBtn").off("click");
                $(".seeBtn").on("click",function(){
                    showFun($(this).attr("data-id"))
                });
                $(".delBtn").off("click");
                $(".delBtn").on("click",function(){
                    delFun($(this).attr("data-id"))
                });
                $(".editBtn").off("click");
                $(".editBtn").on("click",function(){
                    editFun($(this).attr("data-id"))
                });
                $(".loadBtn").off("click");
                $(".loadBtn").on("click",function(){
                    downLoadFun($(this).attr("data-id"))
                });
                $(".downLoadFile").off("click");
                $(".downLoadFile").on("click",function(){
                    downLoadFile($(this).attr("order-id"),$(this).attr("detail-id"))
                });

                $(".word_path").off("click");
                $(".word_path").on("click",function(){
                    downWord($(this).attr("data-url"))
                })
            };






            /**
             * 表格查询操作事件
             * @param creatorName 申请人
             * @param handleStatus 分发状态
             * @param beginTime 开始时间
             * @param endTime 结束时间
             * @version <1> 2018-03-07 cxw : Created.
             */
            var searchFun = function(){
                var createTime = ($("#search_createTime").val().trim()).split('至');
                var param = {};
                param.beginTime = createTime[0];
                param.endTime = createTime[1];
                param.auditStatus = null

                loaderOrderStatistics(param)
                $("#orderGrid").jqGrid('setGridParam',{
                    datatype:'json',
                    postData:param,
                    page:1
                }).trigger("reloadGrid");
            };




            /**
             * 通过点击订单数量查询明细
             */
            var statisticsHrefClickFun = function(auditStatus){
                var createTime = ($("#search_createTime").val().trim()).split('至');
                var param = {};
                param.beginTime = createTime[0];
                param.endTime = createTime[1];
                param.auditStatus = auditStatus;
                console.log(param)

                $("#orderGrid").jqGrid('setGridParam',{
                    datatype:'json',
                    postData:param,
                    page:1
                }).trigger("reloadGrid");

            }

            /**
             *订单详情查看
             * @param orderId 订单ID
             * @return
             * @version <1> 2018-03-07 cxw： Created.
             * @version<2> 2018-04-13 lcw : 为数据路径添加“复制”至剪切板的功能
             */
            var showFun = function(orderId){

                $(".copyBtn").bind("click",copyFun);  //绑定点击事件

                var ajax = new BaseAjax();
                ajax.opts.url = ORDER_CONFIG.queryOrderById_url + "?orderId=" + orderId;
                ajax.opts.contentType = "application/json";
                ajax.opts.async = false; //同步请求
                ajax.opts.successFun = function(result){
                    var data = result.data;
                    $('#view_orderType').html(data.orderType == 1301 ? '数据订单':'需求订单');
                    if(data.orderAttribute == 2101 ){
                        $('#view_orderAttribute').html( '内部订单');
                    }else if(data.orderAttribute == 2102){
                        $('#view_orderAttribute').html( '外部订单');
                    }else{
                        $('#view_orderAttribute').html( '');
                    }
                    $('#view_creatorName').html(data.creatorName);
                    $('#view_createTime').html(data.createTime);
                    $('#view_orderAuditorName').html(data.orderAuditorName);
                    var auditStatus = getAuditStatus(data.auditStatus );
                    $('#view_auditTime').html(data.auditTime);
                    var overdue='<span class="red">(已过期)</span>';
                    if(data.auditStatus==1104){//已分发状态
                        if(data.dataAccessTime!=null && data.dataAccessTime<new Date().Format("yyyy-MM-dd")){
                            $('#view_orderCode').html(data.orderCode+overdue);
                            //$('#view_auditStatus').html('<span class="red">' + auditStatus + '</span>');
                        }else{
                            $('#view_orderCode').html(data.orderCode);
                        }
                        $('#view_auditStatus').html('<span>' + auditStatus + '</span>');
                    }else if(data.auditStatus==1105 || data.auditStatus==1102){//拒绝分发
                        $('#view_orderCode').html(data.orderCode);
                        $('#view_auditStatus').html('<span class="red">' + auditStatus + '</span>');
                    }else{
                        $('#view_orderCode').html(data.orderCode);
                        $('#view_auditStatus').html('<span>' + auditStatus + '</span>');
                    }

                    $('#word_path').html(data.wordName);
                    $('#word_path').attr("title",data.wordName);
                    $('#word_path').attr("order-id",data.orderId);
                    $('#word_path').attr("data-url",data.wordPath);

                    $('#view_handlerPersonName').html(data.handlerPersonName);
                    $('#view_handleTime').html(data.handleTime);
                    $('#view_dataAccessTime').html(data.dataAccessTime!=null ? new Date(data.dataAccessTime).Format("yyyy-MM-dd"):'');
                    if(data.dataPath) {
                        $("#dataPath_hidden").val(data.dataPath);
                        document.getElementById('view_dataPath').innerHTML = data.dataPath;
                        $('#view_dataPath').attr('title',data.dataPath);
                        $(".copyBtn").show();
                    }else{
                        document.getElementById('view_dataPath').innerHTML = "";
                        $(".copyBtn").hide();
                    }
                    if(data.auditSuggestion)
                    {
                        if(data.auditSuggestion.length>15)
                        {
                            document.getElementById('view_auditSuggestion').innerHTML=data.auditSuggestion.substring(0,16)+'...';
                        }
                        else{
                            document.getElementById('view_auditSuggestion').innerHTML=data.auditSuggestion;
                        }

                        $('#view_auditSuggestion').attr('title',data.auditSuggestion)
                    }
                    if(data.handleSuggestion)
                    {
                        if(data.handleSuggestion.length>15)
                        {
                            document.getElementById('view_handleSuggestion').innerHTML=data.handleSuggestion.substring(0,16)+'...';
                        }
                        else{
                            document.getElementById('view_handleSuggestion').innerHTML=data.handleSuggestion;
                        }

                        $('#view_handleSuggestion').attr('title',data.handleSuggestion)
                    }
                    if(data.orderDescription)
                    {
                        document.getElementById('view_orderDescription').innerHTML=data.orderDescription;
                        $('#view_orderDescription').attr('title',data.orderDescription);
                    }
                    if(data.orderDescription)
                    {
                        $('#view_orderDescription').attr('title',data.orderDescription);
                        $('#view_orderDescription').html(data.orderDescription);
                    }
                    if(data.orderType == 1301 )
                    {
                        $("#data_list").css("height","270px");
                        $('.t6').hide();
                    }
                    else{
                        $("#data_list").css("height","225px");
                        $('.t6').show();
                    }
                    var personType = commons.getCookie("personType");
                    if(personType==1701){
                        $('.t5').show();
                    }
                    else{
                        $('.t5').hide();
                    }
                    var orderDialog =  $("#orderInfo");
                    var obj =   $('#data_list');
                    //加载分发文件详情
                    showOrderFileDetailFun(orderId,obj,data.orderType,data.dataAccessTime,data.auditStatus);
                    showDialog(1,orderId,orderDialog);
                    tableEvent();
                };
                ajax.opts.errorFun = function(){
                    PopWin.showMessageWin("订单详情加载失败!");
                    return false;
                };
                ajax.run();
            };



            var triggerDelay = 100;
            var removeDelay = 1000;

            /**
             *订单详情文件查看
             * @param orderId 订单ID
             * @return
             * @version <1> 2018-03-07 cxw： Created.
             */
            var showOrderFileDetailFun = function(orderId,obj,orderType,dataAccessTime,auditStatus){
                $("#batchDownloadBtn").parent().hide();
                var  url = ORDER_CONFIG.queryOrderDetailByOrderId_url;
//                if(orderType == 1301 )
//                {
//                    url = ORDER_CONFIG.queryOrderDetailByOrderId_url;
//                }
//                else{
//                    url = ORDER_CONFIG.queryFileDetailByOrderId_url;
//                }
                var ajax = new BaseAjax();
                ajax.opts.url = url + "?orderId=" + orderId;
                ajax.opts.contentType = "application/json";
                ajax.opts.async = false; //同步请求
                ajax.opts.successFun = function(result){
                    var fileHtml = '';
                    if(result.flag){
                        var data = result.data;
                        if(data.length>0) {
                            for (var i= 0; i < data.length; i++) {
                                var fileSize;
                                var detailId = data[i].orderDetailId;
                                var fileSize = data[i].fileSize;
                                var personType = commons.getCookie("personType");
                                var dataPath = data[i].dataPath + "/" + data[i].fileName;
                                // if(personType==1701){
                                //     $("#downLoadDiv").hide();
                                //     $("#fileCheckBox").hide();
                                //     fileHtml += "<div class='file'><div></div><div title='"+data[i].fileName+"' class='fileName'>"+data[i].fileName+"</div><div class='fileSize'>"+(fileSize|| "---")+"</div></div>";
                                // }
                                // else if(personType==1702){
                                    $("#downLoadDiv").show();
                                    $("#fileCheckBox").show();
                                    fileHtml += "<div class='file'><div><input name='checkbox' type='checkbox' value='"+ detailId +"'></div><div title='"+data[i].fileName+"' class='fileName'>"+data[i].fileName+"</div><div class='fileSize'>"+(fileSize|| "---")+
                                        "</div>";
                                    //判断是否过期 过期下载按钮置灰
                                    if(dataAccessTime!=null && dataAccessTime >=new Date().Format("yyyy-MM-dd") && auditStatus==1104){
                                        // fileHtml+="<div style='float: right !important;'><img src='images/public/download.png' order-id='"+orderId+"'  detail-id='"+ detailId +"'  class='downLoadFile'  title='下载' /></div>";
                                        var suffix = DATA_STORAGE.download_suffix;
                                        fileHtml+="<div style='float: right !important;'><a href='"+suffix+ dataPath +"' target='_blank' title='下载' data-id='"+suffix+ orderId +"' data-path='"+suffix+ dataPath+"'><img src='images/public/download.png'></a></div>";
                                    }else{
                                        fileHtml+="<div style='float: right !important;'><img src='images/public/downloadG.png' /></div>";
                                    }

                                    fileHtml+="</div>";
                                    if(i==data.length-1 && dataAccessTime!=null && dataAccessTime>=new Date().Format("yyyy-MM-dd") && auditStatus==1104){
                                        //fileHtml+="<div style='float: left;'><input type='button' value='批量下载' class='btn btn_grey' id='batchDownloadBtn'></div>";
                                        $("#batchDownloadBtn").parent().show();
                                    }
                                // }
                            }
                        }
                        else{
                            fileHtml += "<h3>没有对应文件数据</h3>";
                        }
                        obj.html(fileHtml)
                    }
                    else{
                        fileHtml += "<h3>没有对应文件数据</h3>";
                        obj.html(fileHtml)
                    }
                };
                ajax.opts.errorFun = function(){
                    PopWin.showMessageWin("单详情文件加载失败!");
                    return false;
                };
                ajax.run();

                //全选和取消全选
                $("#selectAll").click(function() {
                    $("input[name='checkbox']").prop('checked', this.checked);
                    if($("input[name='checkbox']:checked").length > 0){
                        $("#batchDownloadBtn").removeClass("btn_grey");
                    }else{
                        $("#batchDownloadBtn").addClass("btn_grey");
                    }
                });
                $("input[name='checkbox']").click(function() {
                    if ($("input[name='checkbox']").length == $("input[name='checkbox']:checked").length) {
                        $("#selectAll").prop("checked", "checked");
                    } else {
                        $("#selectAll").removeAttr("checked");
                    }
                    if($("input[name='checkbox']:checked").length > 0){
                        $("#batchDownloadBtn").removeClass("btn_grey");
                    }else{
                        $("#batchDownloadBtn").addClass("btn_grey");
                    }
                });

                $("#batchDownloadBtn").bind("click", function () {//批量下载报告
                    if(!$("#batchDownloadBtn").hasClass("btn_grey")){
                        $("input[name='checkbox']:checked").each(function(index, id){
                            var dataPath = $(this).parent().parent().find("a").attr("data-path");
                            window.open(dataPath);
                        });
                    }
                });
            };



            /**
             * 弹出框
             * @param type  : 1 表示新增,2表示查看
             * @param orderId :订单ID
             * @version <1> 2018-03-14 cxw: created.
             */
            var showDialog = function(type,orderId,orderDialog){
                var orderDialog =  orderDialog;
                var dialogParent = orderDialog.parent();
                var dialogOwn = orderDialog.clone();
                orderDialog.dialog({
                    autoOpen: false,
                    title:'订单信息',
                    height: 640,
                    width: 900,
                    modal: true,
                    close:function(){
                        dialogOwn.appendTo(dialogParent);
                        $(this).dialog("destroy").remove();
                    },
                    buttons:[{
                        text:"关闭",
                        click:function(){
                            $(this).dialog("close");
                        }
                    }]
                });
                orderDialog.dialog("open");
            };

            /**
             * 下载订单数据
             * @version <1> 2018-04-09  cxw: created.
             */
            var downLoadFile = function (orderId,detailId) {
                var url = ORDER_CONFIG.downloadOrderDetail_url + "?&orderId="+orderId+ "&orderDetailId=" + detailId +"&AccessToken=" + commons.getAccessToken();
                commons.createIframe(url, triggerDelay, removeDelay);

            };

            /**
             * 下载订单数据动画效果
             * @version <1> 2018-03-26  cxw: created.
             */
            var downLoadGif = function () {
                var dataHandleDialog = $('#orderQueryDialog');
                dataHandleDialog.html("数据正在下载中<span class='dotting'></span>");
                dataHandleDialog.dialog({
                    autoOpen: false,
                    title: '系统提示',
                    height: 160,
                    width: 410,
                    modal: true,
                    buttons: [{
                        text:"隐藏",
                        click:function(){
                            $(this).dialog("close");
                        }}]
                });
                dataHandleDialog.dialog("open");
            };

            /**
             * 初始化table显示样式
             * @version <1> 2018-03-09  cxw: created.
             */
            var chanageTableCss = function(){
                var divObj = $('#orderGrid').parent('div');
                divObj.addClass('tableStyle');
                divObj.css({'maxHeight':($(".rightMain").height()-$(".searchItems").height()  - $(".statisticsTable").height() -$(".ui-jqgrid-hdiv").height())-$("#pager2").height()-20+"px"});
            };

            /**
             * 初始化日期控件
             * @version <1> 2018-03-09  cxw: created.
             */
            var dateFun = function(){
                $("#search_createTime").jeDate({
                    range:"至",
                    multiPane:false,
                    format: 'YYYY-MM-DD'
                });
            };

            /**
             * 下载数据订单申请文件
             * @version <1> 2018-06-26  cxw: created.
             */
            var downWord = function (wordPath) {
                var  AccessToken = commons.getAccessToken();
                setTimeout(function() {
                    var a = document.createElement('a');
                    wordPath = encodeURI(wordPath);
                    a.setAttribute('download','');
                    a.href=ORDER_CONFIG.downloadOrderWord_url+"?url="+wordPath+"&AccessToken="+AccessToken;
                    document.body.appendChild(a);
                    a.click();
                    setTimeout(function() {
                        document.body.removeChild(a);
                    }, 1000);
                }, 100);
            };


            /**
             * 将字符串复制至windows剪切板
             * @version<1> 2018-04-13 lcw :Created.
             */
            var copyFun = function(){
                var obj = document.getElementById("dataPath_hidden");
                obj.select();
                document.execCommand("Copy");
                $("#copyTip").html("复制成功");
                setTimeout(function(){
                    $("#copyTip").html("");
                },1000);

            };
            init();
        });



    </script>

</div>