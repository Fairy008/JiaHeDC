<style type="text/css">
    #view_auditSuggestion,#view_handleSuggestion{
        color: #0b0b0b;
        overflow:hidden;text-overflow:ellipsis;white-space:nowrap;
    }
    #view_orderDescription{resize: none;border: 1px solid #ededed; border-radius: 5px;}
   #dataHandleSuggestion{width: 510px;resize: none; border-radius: 5px;padding: 0 3px;}
    .input{height: 26px; line-height: 26px;  padding: 0 3px;
        border-radius: 5px;outline: none;border: 1px solid #EEEEEE; width: 200px;
    }
    .grayBtn{ cursor: Default !important;}
    #textDiv  table .text_td1{width: 8%!important;text-align: right;border-radius: 5px;}
    #textDiv table .text_td7{ width: 40%!important;  text-align: left;}
    #textDiv table .text_td8{ width: 20%!important;text-align: left;}
    #textDiv { background:  #FAFAFA !important}
    #detail_path{ width: 90%;}

    .DetailInfo{margin: auto;background:#FAFAFA !important; border:1px solid #F3F3F3;}

    .DetailInfo table .four_td1{width: 80px !important;text-align:right;padding-right:2px;}
    .DetailInfo table .four_td2{text-align: left;padding-right:20px;width: calc((100% - 306px)/3) !important;}
    .DetailInfo table{width:100%;text-align: center !important; }
    .DetailInfo tr td{word-wrap: break-word;text-overflow: ellipsis;white-space: nowrap;overflow: hidden;display: inline-block;height: 24px; line-height: 24px;}

    .DetailInfo table .mul_td1{width:calc(100% - 82px) !important;text-align:left;}
    h3{font-weight:normal;padding-top:10px;}

    .file>div:nth-child(1){width:84%;text-align: left;}
    .file>div:nth-child(2){width:16%;text-align:right;}
    .file>div:nth-child(3){width:20%;text-align:right;}
    #file_list{
        height: 350px;
    }

    #data_list{height:230px;}

    .formErrorInfo {
        padding-left: 10px !important;
    }

    /**分发意见样式**/
    .dropdown {
        position:relative;
    }

    .dropdown-toggle {
        display:inline-block;
        width:380px;
        height:26px;
        color:#333;
        text-align:left;
        border-radius:2px;
        border:1px #EEEEEE solid;
    }
    .dropdown-menu {
        z-index: 9999;
        background:#fbfbfb;
        border:1px solid #EEEEEE;
        margin-top:0;
        border-radius:5px;
        position:absolute;
        left:0;
        max-height: 125px;
        overflow-y:auto;
        overflow-x: hidden;
        width: 100%;
    }
    .dropdown-menu ul li{
        width: 100%;
        height: 25px;
        line-height: 25px;
        padding-left: 5px;
    }
    .dropdown-menu ul li:hover{
        background-color: #ecf3f3;
        cursor:pointer;
    }

</style>

<div class="content">
    <div class="searchItems">
        <div class="searchRow">
            <div class="searchBGleft" >
                <div>
                    <span class="label2">订单编号：</span>
                    <span><input type="text" class="input" id="search_orderCode" /> </span>
                </div>
                <!--<div>-->
                    <!--<span class="label2">申请人：</span>-->
                    <!--<span><input type="text" class="input " id="search_creatorName" /></span>-->
                <!--</div>-->
                <div>
                    <span class="label2">订单时间：</span>
                    <span><input type="text" class="input " id="search_createTime" /></span>
                </div>
                <div>
                    <span class="label2">订单状态：</span>
                    <span>
                    <select id="search_handleStatus" class="input " style="text-align:center;" >
                        <option value="">--请选择--</option>
                       <!-- <option value="1">正常</option>
                        <option value="0">禁用</option>-->
                    </select>
                </span>
                </div>
            </div>
            <div class="searchBGright">
                <input type="button" class="btn " value="查询" id="queryBtn" />
                <input type="button" class="btn " id="resetBtn" value="重置" />
            </div>
        </div>

    </div>
    <div class="grid">
        <table id="orderGrid"></table>
        <div id="pager2"></div>
    </div>
    <div id="orderInfo" style="display:none;">
        <div  class="DetailInfo" id="orderInfoDetail" >
            <table>
                <tr>
                    <td class="four_td1">订单编号:</td>
                    <td class="four_td2">
                        <span id="view_orderCode" class="viewType"></span>
                    </td>
                    <td class="four_td1">订单分类:</td>
                    <td class="four_td2">
                        <span id="view_orderType" class="viewType"></span>
                    </td>
                    <td class="four_td1">订单类型:</td>
                    <td class="four_td2">
                        <span id="view_orderAttribute" class="viewType"></span>
                    </td>
                </tr>
                <tr>
                    <td class="four_td1">订单时间:</td>
                    <td class="four_td2">
                        <span id="view_createTime" class="viewType"></span>
                    </td>
                    <td class="four_td1">申请人:</td>
                    <td class="four_td2">
                        <span id="view_creatorName" class="viewType"></span>
                    </td>
                    <td class="four_td1">订单状态:</td>
                    <td class="four_td2">
                        <span id="view_auditStatus" class="viewType"></span>
                    </td>
                    </td>
                </tr>
                <tr style="text-align:left;">
                    <td class="four_td1 t6" style="vertical-align: top;">订单需求:</td>
                    <td  colspan="5" style="width:760px;text-align:left;height: 55px !important;" class="t6">
                        <textarea id="view_orderDescription" style="width:99.7% !important;background: #FAFAFA !important" rows="3" disabled></textarea>
                    </td>
                </tr>
         <!--       <tr>
                    <td class="four_td1">审核时间:</td>
                    <td class="four_td2">
                        <span id="view_auditTime" class="viewType"></span>
                    </td>
                    <td class="four_td1">审核人:</td>
                    <td class="four_td2">
                        <span id="view_orderAuditorName" class="viewType"></span>
                    </td>
                    <td class="four_td1">分发时间:</td>
                    <td class="four_td2">
                        <span id="view_handleTime" class="viewType"></span>
                    </td>
                  &lt;!&ndash;  <td class="four_td1">分发状态:</td>
                    <td class="four_td2">
                        <span id="view_handleStatus" class="viewType"></span>
                    </td>&ndash;&gt;
                </tr>
                <tr>
                    <td class="four_td1">分发人:</td>
                    <td class="four_td2">
                        <span id="view_handlerPersonName" class="viewType"></span>
                    </td>
                    <td class="four_td1">数据有效期:</td>
                    <td class="four_td2">
                        <span id="view_dataAccessTime" class="viewType"></span>
                    </td>
                    <td class="four_td1"></td>
                    <td class="four_td2">
                    </td>
                </tr>
                <tr>
                    <td class="four_td1">审核意见:</td>
                    <td  colspan="2" style="width:205px;text-align:left;">
                        <span id="view_auditSuggestion" class="viewType"></span>
                    </td>
                    <td class="four_td1">分发意见:</td>
                    <td  colspan="2" style="width:495px;text-align:left;">
                        <span id="view_handleSuggestion" class="viewType"></span>
                    </td>
                </tr>
                <tr style="text-align:left;">
                    <td class="four_td1 t6">订单需求:</td>
                    <td colspan="5" style="width:760px;text-align:left;">
                        <span id="view_orderDescription" ></span>
                    </td>
                </tr>-->
            </table>
        </div>
        <div class="fileListDiv" >
            <div class='file_title file'><div style='text-align: center;'>文件名</div><div>文件大小</div></div>
            <div class="file_list" id="data_list"></div>
        </div>
        <div  class="DetailInfo" id="orderInfoDetailBot" >
            <table>
                <tr>
                    <td class="four_td1">审核人:</td>
                    <td class="four_td2">
                        <span id="view_orderAuditorName" class="viewType"></span>
                    </td>
                    <td class="four_td1">审核时间:</td>
                    <td class="four_td2">
                        <span id="view_auditTime" class="viewType"></span>
                    </td>
                    <td class="four_td1">审核意见:</td>
                    <td class="four_td2">
                        <span id="view_auditSuggestion" class="viewType"></span>
                    </td>
                </tr>
                <tr>
                    <td class="four_td1">分发人:</td>
                    <td class="four_td2">
                        <span id="view_handlerPersonName" class="viewType"></span>
                    </td>
                    <td class="four_td1">分发时间:</td>
                    <td class="four_td2">
                        <span id="view_handleTime" class="viewType"></span>
                    </td>
                    <td class="four_td1">分发意见:</td>
                    <td class="four_td2">
                        <span id="view_handleSuggestion" class="viewType"></span>
                    </td>
                </tr>
              <!--  <tr>
                    <td class="four_td1" style="width:70px !important">审核意见:</td>
                    <td  colspan="2" style="width:208px;text-align:left;">
                        <span id="view_auditSuggestion" class="viewType"></span>
                    </td>
                    <td class="four_td1">分发意见:</td>
                    <td  colspan="2" style="width:485px;text-align:left;">
                        <span id="view_handleSuggestion" class="viewType"></span>
                    </td>
                </tr>-->
                <tr style="text-align:left;">
                    <td class="four_td1">有效期:</td>
                    <td colspan="5">
                        <span id="view_dataAccessTime"  class="viewType" style="width:760px;"></span>
                    </td>
                </tr>
                <tr style="text-align:left;">
                    <td class="four_td1 t5">数据路径:</td>
                    <td colspan="5" class="t5">
                        <span id="view_dataPath" style="width:760px;"></span>
                        <!--1px的input text区域，为js复制使用 2018-04-13-->
                        <input type="text" id="dataPath_hidden" style="height:1px ;width:1px ;border:0 !important;color:#FAFAFA;">
                        <span class="btn btn1 copyBtn" >复制</span><span id="copyTip" style="color:red;padding-left:2px;"></span>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <div id="distributeDataOrder" style="display:none;">
        <div  class="DetailInfo" id="orderDetailList" >
            <table >
                <tr>
                    <td class="four_td1">订单编号:</td>
                    <td class="four_td2">
                        <span id="data_orderCode" class="viewType"></span>
                    </td>
                    <td class="four_td1">申请人:</td>
                    <td class="four_td2">
                        <span id="detail_creatorName" class="viewType"></span>
                    </td>
                    <td class="four_td1">订单时间:</td>
                    <td class="four_td2">
                        <span id="detail_createTime" class="viewType"></span>
                    </td>
                </tr>
                <tr>
                    <td class="four_td1">分发路径:</td>
                    <td class="mul_td1" colspan="5">
                        <span id="detail_path" ></span>
                        <!--1px的input text区域，为js复制使用 2018-04-13-->
                        <input type="text" id="dataPath_hidden2" style="height:1px ;width:1px ;border:0 !important;color:#FAFAFA;">
                        <span class="btn btn1 copyBtn" >复制</span><span id="copyTip2" style="color:red;padding-left:2px;"></span>
                    </td>
                </tr>
            </table>
        </div>
        <div class="fileListDiv" >
            <div class='file_title file'><div style='text-align: center;'>文件名</div><div>文件大小</div></div>
            <div class="file_list" id="file_list"></div>
        </div>


        <div id="textDiv">
            <table id="textTab">
                <tr>
                    <td class="text_td1">截止时间:</td>
                    <td class="text_td8">
                        <input type="text" class="input inputWidth_190" id="dataTime"  readonly/>
                    </td>
                    <td class="text_td1">分发意见:</td>
                    <td class="text_td7" >
                       <!-- <input name="handleSuggestion" id="dataHandleSuggestion" class="input inputWidth_190"  type="text"  placeholder="请填写分发意见" />-->
                        <!--<input type="text" class="input" list="opinion" name="handleSuggestion" id="dataHandleSuggestion">
                        <datalist id="opinion">
                        </datalist>-->
                        <div class="dropdown">
                            <input type="text" class="dropdown-toggle" id="dataHandleSuggestion">
                            <div class="dropdown-menu" style="display: none;">
                                <ul>
                                </ul>
                            </div>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
        <div id="errorInfo"></div>
    </div>

    <!--<div id="distributeDataOrder" style="margin-top: 10px;display:none;">
        <div  class="form" id="OrderDetailList" >
            <div>
                <span class="lableDialog">影像时间：</span>
                <span><input type="text" class="input inputWidth_190" id="search_dataTime" />   <input type="button"  value="查询" id="queryFileBtn" /></span>
            </div>

            <table id="orderFileGrid">

            </table>
            <div id="pager"></div>
        </div>
        <div id="selectedFileDatas" class="form"  width="100%" border="1px soild #ccc" cellspacing="0" cellpadding="0">
            <div>
                <span class="lableDialog">截止时间：</span>
                <span><input type="text" class="input inputWidth_190" id="dataTime"  style="font-size: 14px !important;"/></span>
            </div>
            <table id="selectedDatas">
                <thead>
                <tr>
                    <th>序号</th>
                    <th>文件名</th>
                    <th>文件路径</th>
                    <th>影像时间</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>-->


    <div id="orderQueryDialog" style="display:none;" ></div>
    <script>
        require(["jquery","jqGrid","jqueryUi","dateUtil","BaseAjax","formVerfication","PopWin","commons"],function($,jqGrid,jqueryUi,dateUtil, BaseAjax,formVerfication,PopWin,commons){
            var init = function(){
                orderGrid();
                initDateFun();
                $("#queryBtn").bind("click",searchFun);
                $("#resetBtn").on("click",resetFun);

                $(window).resize(function(){
                    $("#orderGrid").setGridWidth($(".rightMain").width() - 30);
                    chanageTableCss();
                });
                chanageTableCss();
                initSelect();
                //initAuditOpinionFun(6000);
            };

            /**
             *  初始化加载下拉框内容
             * @version  <1> 2018-03-06 cxw : Created.:
             */
            var initSelect =  function () {
                initDistributeStatusSelect();

            }

            /**
             * 重置
             * @version<1> 2018-06-21 cxw :created.
             */
            var resetFun = function(){
                $(".input").val("");
                $('#search_handleStatus').html('<option value="">&#45;&#45;请选择&#45;&#45;</option>');
                initSelect();
            }

            /**
             *  根据字典ID获取字典名称，加载审核状态
             * @version  <1> 2018-03-27 cxw : Created.:
             */
            //  审核状态全局变量
            var auditStatusArr = [];
            var getAuditStatus =  function (dictId) {
                var auditStatus;
                for(var i =0;i<auditStatusArr.length;i++)
                {
                    if(auditStatusArr[i][dictId])
                        auditStatus = auditStatusArr[i][dictId];
                }
                return auditStatus;
            }

            /**
             *  初始化根据分发状态编码查询出id，然后根据查询出的id匹配父ID查询出所有字典信息
             * @param dict 字典对象
             * @version  <1> 2018-03-06 cxw : Created.:
             */
            var initDistributeStatusSelect = function () {
                var varyAjax = new BaseAjax();
                varyAjax.opts.url = DICT_COFING.queryDictByCode_url;
                varyAjax.opts.type = "POST";
                varyAjax.opts.async = false; //同步请求
                varyAjax.opts.data = JSON.stringify({'dataCode':'DataAuditType'});
                varyAjax.opts.successFun = function(result){
                    var data = result.data;
                    if(result.flag){
                        if(data.length>0)
                        {
                            var obj = document.getElementById('search_handleStatus');
                            for(var i =0 ;i<data.length;i++ ) {
                                var temp = data[i]
                                if(temp.dictId == 1103 || temp.dictId == 1105){
                                    obj.options.add(new Option(temp.dataName, temp.dictId));
                                }

                                var tempStatus = {};
                                tempStatus[temp.dictId] = temp.dataName;
                                auditStatusArr[i] = tempStatus;
                            }
                        }
                    }
                };
                varyAjax.opts.errorFun = function(){
                    return false;
                };
                varyAjax.run();
            }

            /**
             * jqGrid表格控件加载订单数据
             * @param
             * @version  <1> 2018-03-06 cxw : Created.:
             */
            var orderGrid = function(){
                $("#orderGrid").jqGrid({
                    url: ORDER_CONFIG.findOrderHandleByPage_url,
                    datatype: "json",
                    postData:{
                        'orderParam' : {
                        }
                    },
                    mtype:'POST',
                    jsonReader: {
                        root: "list",
                        total: "pages",
                        page: "page",
                        records: "total",
                        repeatitems: false
                    },
                    rownumbers: true,
                    colNames:['orderId','申请人ID','订单编号','订单分类','订单类型','申请人', '订单时间','订单状态','分发人','分发时间','操作'],
                    colModel:[
                        {name:'orderId',index:'order_id', hidden:true},
                        {name:'creator',index:'creator', hidden:true},
                        {name:'orderCode',index:'order_code',align:'center', width:'12%', sortable:true},
                        {name:'orderType',index:'order_type',align:'center', width:'7%',formatter:function(cellvalue, options, rowObject){
                            var orderType;
                            if(cellvalue==1301) orderType = '数据订单';
                            if(cellvalue==1302) orderType = '需求订单';
                            return orderType;
                        }},
                        {name:'orderAttribute',index:'order_attribute',align:'center', width:'7%',formatter:function(cellvalue, options, rowObject){
                            var orderType = "";
                            if(cellvalue==2101) orderType = '内部订单';
                            if(cellvalue==2102) orderType = '外部订单';

                            return orderType;
                        }},
                        {name:'creatorName',index:'creator_name',align:'center', width:'10%', sortable:true},
                        {name:'createTime',index:'create_time',align:'center', width:'17%', sortable:true},
                        {name:'auditStatus',index:'audit_status', width:'7%', align:"center", sortable:true,formatter:function(cellvalue, options, rowObject){
                            var auditStatus;
                            auditStatus = getAuditStatus(cellvalue);
                            return auditStatus;
                        }},
                        {name:'handlerPersonName',index:'handlerPersonName',align:'center', width:'10%', sortable:true},
                        {name:'handleTime',index:'handle_time', width:'18%',align:'center', sortable:true},
                        {name:'cz',index:'cz', width:'12%',align:"center", sortable:false,formatter:function(cellvalue, options, rowObject){
                            var str = "<img src='images/public/Twatch.png' class='seeBtn' data-id='"+ rowObject.orderId +"' title='订单详情' >" ;
                            if(rowObject.auditStatus==1103)
                            {
                                str+= "<img src='images/public/pickOut.png' class='linkBtn' creator-id='"+ rowObject.creator+"' data-id='"+ rowObject.orderId +"' title='分发' >" ;
                            }
                            else if(rowObject.auditStatus==1105){
                                str+= "<img src='images/public/Trefresh.png' class='linkBtn' creator-id='"+ rowObject.creator+"'data-id='"+ rowObject.orderId +"' title='重新分发' >" ;
                            }
                            else {
                                str+= "<img src='images/public/pickOutG.png' class='grayBtn'  title='分发' >" ;
                            }
                            return str;
                        }}
                    ],
                    width:'100%',
                    autowidth:true,
                    height:'100%',
                    rowNum:15,
                    rowList:[15,30],
                    pager: '#pager2',
                    //sortname: 'orderId',
                    viewrecords: true,
                    sortorder: "desc",
                    loadComplete:function(){
                        commons.isNextDisable();
                        tableEvent();
                        $("#orderGrid").setGridWidth($(".rightMain").width() - 30);
                    }
                });
            };

            /**
             * 绑定table表格操作事件
             *  @version <1> 2018-3-14 cxw : Created.
             */
            var tableEvent = function(creator){
                $(".seeBtn").off("click");
                $(".seeBtn").on("click",function(){
                    showFun($(this).attr("data-id"))
                })
                $(".linkBtn").off("click");
                $(".linkBtn").on("click",function(){
                    loadDistributeDialog($(this).attr("data-id"),$(this).attr("creator-id"));
                })
                $("#queryFileBtn").off("click");
                $("#queryFileBtn").on("click",function(){
                    searchFileFun();
                })

                $(".delRow").off("click");
                $(".delRow").on("click",function(){
                    delRow($(this).attr("row-id"));
                })
                $(".addBtn").off("click");
                $(".addBtn").on("click",function(){
                    var param={};
                    param.storageId =  $(this).attr("storage-id");
                    param.orderId =  $(this).attr("order-id");
                    param.storageUrl =  $(this).attr("storage-url");
                    param.fileName =  $(this).attr("file-name");
                    param.dataTime =  $(this).attr("data-time");
                    param.creator =  $(this).attr("creator-id");
                    addTable(param);
                })
            }

            /**
             * 加载订单分发页
             * @param orderId 订单Id
             * @version <1> 2018-3-15 cxw : Created.
             */
        /*    var loadDistributeDialog = function (orderId,creator) {
                var orderDialog = $('#distributeDataOrder');
                showDialog(2,orderDialog);
                orderDistributeGridByOrderId(orderId,creator);
                tableEvent();

            }*/

            /**
             *加载订单分发页
             * @param orderId 订单ID
             * @version <1> 2018-03-14 cxw： Created.
             */
            var loadDistributeDialog = function (orderId,creator) {

                $(".copyBtn").bind("click",function(){
                    copyFun('dataPath_hidden2','copyTip2');
                });  //绑定点击事件

                var ajax = new BaseAjax();
                ajax.opts.url = ORDER_CONFIG.queryOrderDistributeDetailById_url + "?orderId=" + orderId;
                ajax.opts.contentType = "application/json";
                ajax.opts.async = false; //同步请求
                ajax.opts.successFun = function(result){
                    if(result.flag)
                    {
                        var data = result.data;;
                        var orderDialog;
                        $('#data_orderCode').html(data.orderCode);
                        $('#detail_creatorName').html(data.creatorName);
                        $('#detail_createTime').html(data.createTime);
                        $('#detail_path').html(data.dataPath);
                        $('#detail_path').attr("title",data.dataPath);
                        $("#dataPath_hidden2").val(data.dataPath);
                        orderDialog = $('#distributeDataOrder');
                        var obj =   $('#file_list');
                        showFileDetailFun(orderId,obj);
                        showDialog(2,orderDialog,orderId);

                        commons.loadAlarmMsgFun();
                    }
                    else{
                        PopWin.showMessageWin("订单分发页加载失败!");
                    }
                };
                ajax.opts.errorFun = function(){
                    PopWin.showMessageWin("订单分发页加载失败!");
                    return false;
                };
                ajax.run();
                initAuditOpinion("distributeDataOrder");//意见初始化
            }


            /**
             *订单分发时文件详情查看
             * @param orderId 订单ID
             * @version <1> 2018-03-22 cxw： Created.
             */
            var showFileDetailFun = function(orderId,obj){
                var ajax = new BaseAjax();
                ajax.opts.url = ORDER_CONFIG.queryFileDetailByOrderId_url + "?orderId=" + orderId;
                ajax.opts.contentType = "application/json";
                ajax.opts.async = false; //同步请求
                ajax.opts.successFun = function(result){
                    if(result.flag){
                        var data = result.data;
                        var fileHtml = '';
                        if(data.length>0) {
                            for (var i= 0; i < data.length; i++) {
                                var filesize = data[i].fileSize;
//                                filesize = (filesize/1024).toFixed(2);
                                fileHtml += "<div class='file'><div title='"+data[i].fileName+"'>"+data[i].fileName+"</div><div>"+(filesize || "---")+"</div></div>";
//                                fileHtml += '<tr><td class="t01" title="'+data[i].fileName+'">' + data[i].fileName + '</td><td class="t02">' + (filesize!=null?(filesize+'M'):'') + '</td></tr>'
                            }
                        }
                        else{
                            fileHtml += "<h3>没有对应文件数据</h3>";
//                            fileHtml = '<tr><td colspan="3">' +'没有对应文件数据'+ '</td></tr>'
                        }
                        obj.html(fileHtml)
                    }
                    else{
                       var fileHtml = "<h3>没有对应文件数据</h3>";
//                        var fileHtml = '<tr><td colspan="3">' +'没有对应文件数据'+ '</td></tr>'
                        obj.html(fileHtml)
                    }
                };
                ajax.opts.errorFun = function(){
                    PopWin.showMessageWin("订单详情文件加载失败!");
                    return false;
                };
                ajax.run();
            };

            /**
             * 表格查询操作事件
             * @param creatorName 申请人
             * @param handleStatus 分发状态
             * @param beginTime 开始时间
             * @param endTime 结束时间
             * @version <1> 2018-03-07 cxw : Created.
             */
            var searchFun = function(){
//                var creatorName = $("#search_creatorName").val().trim();
                var createTime = ($("#search_createTime").val().trim()).split('至');
               // var auditStatus = $("#search_auditStatus").val().trim();
                var handleStatus = $("#search_handleStatus").val().trim();
                var orderCode = $("#search_orderCode").val().trim();
                var param = {};
//                param.creatorName = creatorName;
                param.auditStatus = handleStatus;
//                param.handleStatus = handleStatus;
                param.orderCode = orderCode;
                param.beginTime = createTime[0];
                param.endTime = createTime[1];
                $("#orderGrid").jqGrid('setGridParam',{
                    datatype:'json',
                    postData:param,
                    page:1
                }).trigger("reloadGrid");
            }

            /**
             * 弹框表格查询操作事件
             * @param beginTime 开始时间
             * @param endTime 结束时间
             * @version <1> 2018-03-15 cxw : Created.
             */
            var searchFileFun = function () {
                var param={};
                var createTime = ($("#search_dataTime").val().trim()).split('至');
                param.beginTime = createTime[0];
                param.endTime = createTime[1];
                $("#orderFileGrid").jqGrid('setGridParam',{
                    datatype:'json',
                    postData:param,
                    page:1
                }).trigger("reloadGrid");
            }

            /**
             *订单详情查看
             * @param orderId 订单ID
             * @return
             * @version <1> 2018-03-07 cxw： Created.
             */
            var showFun = function(orderId){

                $(".copyBtn").bind("click",function(){
                    copyFun('dataPath_hidden','copyTip')
                });  //绑定点击事件
                var ajax = new BaseAjax();
                ajax.opts.url = ORDER_CONFIG.queryOrderDistributeDetailById_url + "?orderId=" + orderId;
                ajax.opts.contentType = "application/json";
                ajax.opts.async = false; //同步请求
                ajax.opts.successFun = function(result){
                    var data = result.data;
                    $('#view_orderType').html(data.orderType == 1301 ? '数据订单':'需求订单');
                    $('#view_creatorName').html(data.creatorName);
                    $('#view_createTime').html(data.createTime);
                    $('#view_orderCode').html(data.orderCode);
                    $('#view_orderAuditorName').html(data.orderAuditorName);
                    $('#view_dataPath').html(data.dataPath);
                    $("#dataPath_hidden").val(data.dataPath);
                    var auditStatus = getAuditStatus(data.auditStatus);
                    if(data.auditStatus==1105){
                        $('#view_auditStatus').html("<span class='red'>" + auditStatus + "</span>");
                    }else{
                        $('#view_auditStatus').html("<span>" + auditStatus + "</span>");
                    }

                    $('#view_auditTime').html(data.auditTime);
                    $('#view_handlerPersonName').html(data.handlerPersonName);
                     if(data.orderAttribute==2101)
                     {
                        $("#view_orderAttribute").html('内部订单') ;
                     }
                     else{
                        $("#view_orderAttribute").html('外部订单') ;
                     }
                     $('#view_handleTime').html(data.handleTime);
                     $('#view_dataAccessTime').html(data.dataAccessTime!=null ? new Date(data.dataAccessTime).Format("yyyy-MM-dd"):'');
                     if(data.auditSuggestion)
                     {
                       if(data.auditSuggestion.length>15)
                       {
                           document.getElementById('view_auditSuggestion').innerHTML=data.auditSuggestion.substring(0,16)+'...';
                       }
                       else{
                          document.getElementById('view_auditSuggestion').innerHTML=data.auditSuggestion;
                        }

                        $('#view_auditSuggestion').attr('title',data.auditSuggestion)
                     }
                     if(data.handleSuggestion)
                     {
                      if(data.handleSuggestion.length>15)
                      {
                           document.getElementById('view_handleSuggestion').innerHTML=data.handleSuggestion.substring(0,16)+'...';
                       }
                      else{
                           document.getElementById('view_handleSuggestion').innerHTML=data.handleSuggestion;
                       }
                        $('#view_handleSuggestion').attr('title',data.handleSuggestion)
                     }
                    if(data.orderDescription)
                    {
                        document.getElementById('view_orderDescription').innerHTML=data.orderDescription;
                        $('#view_orderDescription').attr('title',data.orderDescription);
                    }
                    var orderDialog =  $("#orderInfo");
                    var obj =   $('#data_list');
                    showFileDetailFun(orderId,obj);
                    showDialog(1,orderDialog);
                };
                ajax.opts.errorFun = function(){
                    PopWin.showMessageWin("订单详情加载失败!");
                    return false;
                };
                ajax.run();
            };

            /**
             *订单详情文件查看
             * @param orderId 订单ID
             * @return
             * @version <1> 2018-03-07 cxw： Created.
             */
            var showOrderFileDetailFun = function(orderId,obj){
                var ajax = new BaseAjax();
                ajax.opts.url = ORDER_CONFIG.queryOrderDetailByOrderId_url + "?orderId=" + orderId;
                ajax.opts.contentType = "application/json";
                ajax.opts.async = false; //同步请求
                ajax.opts.successFun = function(result){
                    if(result.flag){
                        var data = result.data;
                        var fileHtml = '';
                        if(data.length>0) {
                            for (var i= 0; i < data.length; i++) {
                                fileHtml += "<div class='file'><div title='"+data[i].fileName+"'>"+data[i].fileName+"</div><div>"+(data[i].dataSize || "---")+"</div></div>";
//                                fileHtml += '<tr><td class="t1" title="'+data[i].fileName+'">' + data[i].fileName + '</td><td class="t2">' + (data[i].dataSize!=null?data[i].dataSize:'') + '</td><td class="t3">' + data[i].dataTime + '</td></tr>'
                            }
                        }
                        else{
                               fileHtml += "<h3>没有对应文件数据</h3>";
//                            fileHtml = '<tr><td colspan="3">' +'没有对应文件数据'+ '</td></tr>'
                        }
                        obj.html(fileHtml)
                    }
                    else{
                       var fileHtml = "<h3>没有对应文件数据</h3>";
//                        var fileHtml = '<tr><td colspan="3">' +'没有对应文件数据'+ '</td></tr>'
                        obj.html(fileHtml)
                    }
                };
                ajax.opts.errorFun = function(){
                    PopWin.showMessageWin("订单详情文件加载失败!");
                    return false;
                };
                ajax.run();
            };

            /**
             * jqGrid表格控件加载订单关联文件信息
             * @param
             * @version  <1> 2018-03-15 cxw : Created.:
             */
        /*    var orderDistributeGridByOrderId= function(orderId,creator){
                //$("#gbox_orderFileGrid").html('')
                $("#orderFileGrid").jqGrid({
                    url: ORDER_CONFIG.queryOrderFileByPage_url,
                    datatype: "json",
                    postData:{
                        'dataStorageParam' : {
                        }
                    },
                    mtype:'POST',
                    jsonReader: {
                        root: "list",
                        total: "pages",
                        page: "page",
                        records: "total",
                        repeatitems: false
                    },
                    rownumbers: true,
                    colNames:['storageId','文件名','文件路径','影像时间','操作'],
                    colModel:[
                        {name:'storageId',index:'storageId', hidden:true},
                        {name:'fileName',index:'fileName',align:'center', width:'5%', sortable:true},
                        {name:'storageUrl',index:'storageUrl',align:'center', width:'5%', sortable:true},
                        {name:'dataTime',index:'dataTime',align:'center', width:'5%', sortable:true},
                        {name:'cz',index:'cz', width:'5%',align:"center", sortable:false,formatter:function(cellvalue, options, rowObject){
                            var str =  "<img src='images/public/add.png' class='addBtn' file-name='"+rowObject.fileName+"' order-id='"+orderId
                                       +"' data-time= '"+ rowObject.dataTime+ "' storage-url= '"+rowObject.storageUrl + "'creator-id='"+ creator + "' storage-id='"+ rowObject.storageId +"' title='添加' />";
                            return str;
                        }}
                    ],
                    width:'100%',
                    autowidth:true,
                    height:'100%',
                    rowNum:10,
                    rowList:[10,20,30],
                    pager: '#pager',
                    sortname: 'storageId',
                    viewrecords: true,
                    sortorder: "desc",
                    loadComplete:function(){
                        commons.isNextDisable();
                        tableEvent();
                        $("#orderFileGrid ,#gbox_orderFileGrid").setGridWidth($("#OrderDetailList").width());
                    }
                });
            };*/

            /**
             * 添加文件列表事件
             * 将选择的文件添加到表格，可添加多个
             * rowCount 行数，delCount 删除的第几行
             * @version <1> 2018-3-15 cxw : Created.
             */
          /*  var rowCount = 0,delCount=0;
            var addTable = function (param) {
                if( param==undefined) return;
                //判断当前选择文件是否存在已选择文件列表中
                var bool = isRepeatAddedFile(param);
                if(!bool) return;
                if(getSaveData().dataStorages.length==0){
                    rowCount = 0;
                }
                //添加行
                rowCount++;
                var rowTemplate = '<tr class="tr_'+rowCount+'"><td>'+rowCount+'</td><td title="'+param.fileName+'" class="cl1" order-id="'
                        +param.orderId+'" file-name="'+param.fileName+'" storage-url="'+param.storageUrl+'"creator-id="'+ param.creator
                        +'" storage-id="'+param.storageId+'" title="'+param.fileName+'">'+param.fileName+'</td>'
                        +'<td class="cl1" title="'+param.storageUrl+'" data-id="'+param.storageUrl+'" title="'+param.storageUrl+'">'+param.storageUrl+'</td>'
                        +'<td class="cl1" title="'+param.dataTime+'" data-id="'+param.dataTime+'" title="'+param.dataTime+'">'+param.dataTime+'</td>';
                rowTemplate+='<td class="cl1"><img src="images/public/Tdelete.png" class="delRow"  row-id="'+ rowCount+'" title="删除" ></td></tr>';
                var tableHtml = $("#selectedDatas tbody").html();
                if(tableHtml!=null)
                {
                    tableHtml += rowTemplate;
                }
                else {
                    tableHtml = rowTemplate;
                }
                $("#selectedDatas tbody").html(tableHtml);
                tableEvent();
            }*/

            /**
             *判断当前选择文件是否存在已选择文件列表中
             * @version <1> 2018-3-15 cxw : Created.
             **/
        /*    var isRepeatAddedFile = function (param) {
                var permissionArr = getSaveData().dataStorages;
                var bool = true;
                for(var num in permissionArr)
                {
                    var permission = permissionArr[num];
                    if(param.storageId==permission.storageId)
                    {
                        PopWin.showMessageWin("该文件已选择，不能重复选择")
                        bool =  false;
                    }
                }
                return bool;
            }*/

            /**
             * 获取选择的文件数据
             * @version <1> 2018-3-15 cxw : Created.
             */
        /*    var arr
            var getSaveData = function(){
                // 遍历所有的table数据
                html='';
                $('#selectedDatas').find('tbody').each(function () {
                    $(this).find('tr').each(function () {
                        $(this).find('td').each(function () {
                            html += ($(this).attr("storage-id")==undefined?'':$(this).attr("storage-id")) + ','
                                  +($(this).attr("storage-url")==undefined?'':$(this).attr("storage-url"))
                                  + ','+($(this).attr("file-name")==undefined?'':$(this).attr("file-name"))+ ','
                                  +($(this).attr("order-id")==undefined?'':$(this).attr("order-id")) + ','
                                  +($(this).attr("creator-id")==undefined?'':$(this).attr("creator-id")) + ',';
                        });
                        html += '|';
                    });
                    return false;
                });
                var arr = html.split("|")
                var prodParam = [];
                var creator;
                for(var temp in arr) {
                    if (arr[temp] != null && arr[temp] != "") {
                        var productarr = (arr[temp].replace("undefined", "").replace("undefined", "").trim().split(","));
                        var productarr = arrReplaceNone(productarr);
                        var product;
                            product = {
                                storageId:productarr[0],
                                storageUrl:productarr[1],
                                fileName:productarr[2],
                                orderId:productarr[3]
                            }
                        creator = productarr[4];
                        prodParam.push(product)
                    }
                }
                var orderParam = {
                    orderId:prodParam.length>0?prodParam[0].orderId:null,
                    dataAccessTime:$('#dataTime').val(),
                    creator:creator,
                    dataStorages:prodParam
                };
                return orderParam;
            };*/

            /**
             * 数组去掉空值
             * @param 已选择的权限对象组成的数组
             * @version <1> 2018-1-17 cxw : Created.
             */
           /* var arrReplaceNone = function (productarr) {
                for(var i = 0 ;i<productarr.length;i++)
                {
                    if(productarr[i] == "" || typeof(productarr[i]) == "undefined")
                    {
                        productarr.splice(i,1);
                        i= i-1;
                    }
                }
                return productarr;
            }*/

            /**
             * 删除行
             * @param _id 行数
             * @version <1> 2018-3-15 cxw : Created.
             */
           /* var  delRow = function(_id){
                $("#selectedDatas .tr_"+_id).remove();
                if(rowCount == _id )  rowCount--;
            }*/

            /**
             * 弹出框
             * @param orderDialog 弹框对象
             * @param type :值为1时显示详情，为2时显示订单分发页
             * @version <1> 2018-03-15 cxw: created.
             */
            var showDialog = function(type,orderDialog,orderId){
                var orderDialog =  orderDialog;
                var dialogParent = orderDialog.parent();
                var dialogOwn = orderDialog.clone();
                if(type==1)
                {
                    orderDialog.dialog({
                        autoOpen: false,
                        title:'订单信息',
                        height: 610,
                        width: 900,
                        modal: true,
                        close:function(){
                            dialogOwn.appendTo(dialogParent);
                            $(this).dialog("destroy").remove();
                        },
                        buttons:[{
                            text:"关闭",
                            click:function(){
                                $(this).dialog("close");
                            }
                        }]
                    });
                }
                else{
                    orderDialog.dialog({
                        autoOpen: false,
                        title:'订单分发',
                        height: 635,
                        width: 900,
                        modal: true,
                        close:function(){
                            dialogOwn.appendTo(dialogParent);
                            $(this).dialog("destroy").remove();
                        },
                        buttons:[{
                            text:"同意分发",
                            click:function(){
                                var dataTime = $('#dataTime').val();
                                if(!formVerfTimeAndLength()){
                                    return ;
                                }
                                //保存分发信息
                                saveNeedOrder(1104,orderId, $(this));
                            }},{
                            text:"拒绝分发",
                            click:function(){
                                //var handleSuggestion = $("#dataHandleSuggestion").val();
                                var dataTime = $('#dataTime').val();
                                if(!formVerf()){
                                    return ;
                                }
                                //保存分发信息
                                saveNeedOrder(1105,orderId,$(this));
                            }},{
                            text:"取消",
                            click:function(){
                                $(this).dialog("close");
                            }
                        }]
                    });
                    initDateFunByDialog();
                }
                orderDialog.dialog("open");
            };

            /**
             * 需求订单分发保存
             * @version <1> 2018-03-22 cxw: created.
             */
            var saveNeedOrder = function (handleStatus,orderId,dialogObj) {
                var handleSuggestion = $("#dataHandleSuggestion").val();
                var dataTime = $('#dataTime').val();
                var orderParam={} ;
                orderParam.auditStatus = handleStatus;
                orderParam.handleSuggestion = handleSuggestion;
                orderParam.orderId = orderId;
                orderParam.dataAccessTime = dataTime;
                var varyAjax = new BaseAjax();
                varyAjax.opts.url = ORDER_CONFIG.distributeOrder_url;
                varyAjax.opts.type = "POST";
                varyAjax.opts.async = false; //同步请求
                varyAjax.opts.data = JSON.stringify(orderParam);
                varyAjax.opts.successFun = function(result){
                    var data = result.data;
                    if(result.flag){
                        PopWin.showMessageWin(result.msg);
                        //关闭弹窗
                        dialogObj.dialog("close");
                        //刷新分发列表
                        searchFun();

                        commons.loadAlarmMsgFun();

                    }
                    else{
                        //PopWin.showMessageWin(result.msg);
                        var showTargetObj =  $('#errorInfo');
                        if(showTargetObj.find('.formErrorInfo').length != 0){
                            showTargetObj.find('.formErrorInfo').remove();
                        }
                        showTargetObj.append('<div class="formErrorInfo"><span>' +result.msg + '</span></div>');
                        return;
                    }
                };
                varyAjax.opts.errorFun = function(){
                    PopWin.showMessageWin('需求订单分发失败');
                    return false;
                };
                varyAjax.run();

            }


            /**
             * 需求订单分发保存
             * @version <1> 2018-03-16 cxw: created.
             */
        /*    var saveNeedOrder = function (handleStatus) {
                var dataTime = $('#dataTime').val();
                if((dataTime==null||dataTime=='')&&handleStatus==1202)
                {
                    PopWin.showMessageWin('请选择截止时间');
                    return;
                }
                //获取需要分配的权限数据
                var orderParam = getSaveData();
                orderParam.handleStatus = handleStatus;
                if(orderParam!=null)
                {
                    if(orderParam.dataStorages.length>0)
                    {
                        var varyAjax = new BaseAjax();
                        varyAjax.opts.url = ORDER_CONFIG.distributeOrder_url;
                        varyAjax.opts.type = "POST";
                        varyAjax.opts.async = false; //同步请求
                        varyAjax.opts.data = JSON.stringify(orderParam);
                        varyAjax.opts.successFun = function(result){
                            var data = result.data;
                            if(result.flag){
                                PopWin.showMessageWin(result.msg);
                            }
                            else{
                                PopWin.showMessageWin(result.msg);
                            }
                        };
                        varyAjax.opts.errorFun = function(){
                            PopWin.showMessageWin('需求订单分发失败');
                            return false;
                        };
                        varyAjax.run();
                    }
                    else{
                        PopWin.showMessageWin('请选择元数据');
                    }
                }
                else{
                    PopWin.showMessageWin('请选择元数据');
                }
            }*/


            var chanageTableCss = function(){
                var divObj = $('#orderGrid').parent('div');
                divObj.addClass('tableStyle');
                divObj.css({'maxHeight':($(".rightMain").height()-$(".searchItems").height()-$(".ui-jqgrid-hdiv").height())-$("#pager2").height()-50+"px"});

                $("#orderFileGrid").setGridWidth($("#OrderDetailList").width());

                /*var divObj = $('#orderFileGrid').parent('div');
                divObj.addClass('tableStyle');
                divObj.css({'maxHeight':($("#OrderDetailList").height()-$(".searchItems").height()-$(".ui-jqgrid-hdiv").height())-$("#pager").height()-50+"px"});*/

            }


            /**
             * 第一次加载页面时加载事件控件
             * @version <1> 2018-03-15 cxw: created.
             */
            var initDateFun = function () {
                dateMultiFun($("#search_createTime"))
            }

            /**
             * 加载弹框页面时加载事件控件
             * @version <1> 2018-03-15 cxw: created.
             */
            var initDateFunByDialog = function () {
                dateMultiFun($("#search_dataTime"));
                dateFun($("#dataTime"));


                $("#dataTime").on("click",function(){
                    $(".dropdown-menu").css("display","none");

                })
            }

            /**
             * 加载双面板时间控件
             * @param obj input对象
             * @version <1> 2018-03-15 cxw: created.
             */
            var dateMultiFun = function(obj){
                  obj.jeDate({
                    range:"至",
                    multiPane:false,
                    format: 'YYYY-MM-DD'
                });

            };

            var formVerf = function(){
                var addOrderInfo = $('#errorInfo');
                if(formVerfication.checkInputIsEmpty($('#dataHandleSuggestion'),addOrderInfo,'分发意见不能为空')){
                    return false;
                }
                if(formVerfication.checkInputLength(0,100,$('#dataHandleSuggestion'),addOrderInfo,'分发意见不能超过100字')){
                    return false;
                }
                return true;
            }

            var formVerfTimeAndLength = function(){
                var addOrderInfo = $('#errorInfo');
                if(formVerfication.checkInputIsEmpty($('#dataTime'),addOrderInfo,'截止时间不能为空')){
                    return false;
                }
                if(formVerfication.checkInputLength(0,100,$('#dataHandleSuggestion'),addOrderInfo,'分发意见不能超过100字')){
                    return false;
                }
                return true;
            }


            /**
             * 加载单面板时间控件
             * @param obj input对象
             * @version <1> 2018-03-15 cxw: created.
             */
            var dateFun = function(obj){

                obj.jeDate({
                    format: 'YYYY-MM-DD',
                    minDate:$.nowDate({DD:"0"}),
                    isToday:false
                });

            };

            /**
             * 将字符串复制至windows剪切板
             * @version<1> 2018-04-13 lcw :Created.
             */
            var copyFun = function(hiddenId, tip){
                var obj = document.getElementById(hiddenId);
                obj.select();
                document.execCommand("Copy");
                $("#" + tip).html("复制成功");
                setTimeout(function(){
                    $("#" + tip).html("");
                },1000);

            }

            /**
             * 获取fenfa意见下拉框数据
             * @version <1> 2018-05-28 wl: created.
             */
            var initAuditOpinionFun = function(parentId){
                var ajax = new BaseAjax();
                ajax.opts.url = DICT_COFING.queryDictByParentId_url;
                ajax.opts.contentType = "application/json";
                ajax.opts.async = false;
                ajax.opts.data = JSON.stringify({'parentId' : parentId});
                ajax.opts.successFun = function(result){
                    var str = "";
                    if(result.flag){
                        $.each(result.data, function(index, element){
                            //str += "<option>"+ element.dataName +"</option>";
                            str+="<li class='option viewType' title='"+ element.dataName +"'>"+ element.dataName +"</li>";
                        })
                        $(".dropdown-menu ul").html(str);
                    }
                }
                ajax.run();
            }

            /**
             * Description: 分发意见初始化
             * @return
             * @version <1> 2018/5/30 11:26 zhangshen: Created.
             */
            var initAuditOpinion = function(idName){
                $("#"+idName+" .dropdown-menu ul").html("");
                initAuditOpinionFun(6000);
                //显示\隐藏下拉菜单
                $("#"+idName+" .dropdown-menu").hide();
                $("#"+idName+" .dropdown-toggle").click(function() {
                    var len = $(this).parent().find("li").length;
                    if(len > 5){
                        $("#"+idName+" .dropdown-menu").css("top","-"+ 5 * 25 +"px");
                    }else{
                        $("#"+idName+" .dropdown-menu").css("top","-"+ len * 25 +"px");
                    }

                    $("#"+idName+" .dropdown-menu").toggle();
                });
                var dropdown = $("#"+idName+" .dropdown");
                dropdown.on('click',function(e){e.stopPropagation();}).find(">"+ "#"+idName +" li").on('click',function(){
                    dropdown.find("#"+idName+" .dropdown-menu").show();
                });
                $(document).on('click',function(){
                    dropdown.find(".dropdown-menu").hide();
                });
                //赋值
                $("#"+idName +" .dropdown-menu li.option").click(function(){
                    $("#"+idName +" .dropdown-menu").hide();
                    $("#dataHandleSuggestion").val($(this).text());
                });
                //添加输入值后下拉框隐藏事件
                $("#"+idName).bind('input propertychange', function() {
                    $("#"+idName+" .dropdown-menu").hide();
                });
            };

            init();
        });

    </script>

</div>