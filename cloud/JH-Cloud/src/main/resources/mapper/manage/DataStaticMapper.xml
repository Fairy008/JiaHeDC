<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jh.manage.storage.mapping.IDataStaticMapper">
  <resultMap id="BaseResultMap" type="com.jh.manage.storage.entity.DataStatic">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="static_id" jdbcType="INTEGER" property="staticId" />
    <result column="data_status" jdbcType="CHAR" property="dataStatus" />
    <result column="del_flag" jdbcType="CHAR" property="delFlag" />
    <result column="create_time" jdbcType="DATE" property="createTime" />
    <result column="creator_name" jdbcType="VARCHAR" property="creatorName" />
    <result column="creator" jdbcType="INTEGER" property="creator" />
    <result column="modify_time" jdbcType="DATE" property="modifyTime" />
    <result column="modifier_name" jdbcType="VARCHAR" property="modifierName" />
    <result column="modifier" jdbcType="INTEGER" property="modifier" />
    <result column="remark" jdbcType="VARCHAR" property="remark" />
    <result column="region_id" jdbcType="BIGINT" property="regionId" />
    <result column="words" jdbcType="VARCHAR" property="words" />
    <result column="file_path" jdbcType="VARCHAR" property="filePath" />
    <result column="file_size" jdbcType="VARCHAR" property="fileSize" />
    <result column="region_name" jdbcType="VARCHAR" property="regionName" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    static_id, data_status, del_flag, create_time, creator_name, creator, modify_time, 
    modifier_name, modifier, remark, region_id, words, file_path, file_size
  </sql>

  <!-- 矢量数据导入，插入明细记录 -->
  <insert id="insertDataStatic" parameterType="java.util.List">
    insert into data_static (
    create_time, creator_name, creator,
    region_id, words,
    file_path, file_size)
    <trim prefix="values"  suffixOverrides="," >
      <foreach collection="list" item="detail" index="index">
        <trim prefix="(" suffix=")," suffixOverrides=",">
          now(), #{detail.creatorName,jdbcType=VARCHAR}, #{detail.creator,jdbcType=INTEGER},
          #{detail.regionId,jdbcType=VARCHAR}, #{detail.words,jdbcType=VARCHAR},
          #{detail.filePath,jdbcType=VARCHAR}, #{detail.fileSize,jdbcType=VARCHAR}
        </trim>
      </foreach>
    </trim>
  </insert>

  <!-- 矢量数据查询 -->
  <select id="findByPage" parameterType="ImportStaticParam" resultMap="BaseResultMap">
    select
    t.static_id, t.data_status, t.del_flag, t.create_time, t.creator_name, t.creator, t.modify_time,
    t.modifier_name, t.modifier, t.remark,
    (select t1.china_name from init_region t1 where t1.region_id = t.region_id) as region_name,
    t.words, t.file_path, t.file_size
    from data_static t where t.del_flag = '1'
    <if test="dataStatic != null">
      <if test="dataStatic.regionId != null and dataStatic.regionId != ''">
        and t.region_id =#{dataStatic.regionId,jdbcType=VARCHAR}
      </if>
      <if test="dataStatic.words != null and dataStatic.words != ''">
        and t.words like '%' || #{dataStatic.words,jdbcType=VARCHAR} || '%'
      </if>
      <if test="dataStatic.creatorName != null and dataStatic.creatorName != ''">
        and t.creator_name like '%' || #{dataStatic.creatorName,jdbcType=VARCHAR} || '%'
      </if>
    </if>
    <if test="beginTime != null and beginTime != '' and endTime != null and endTime != ''">
      and to_char(to_date(cast(t.create_time as varchar),'yyyy-mm-dd'), 'yyyy-mm-dd') BETWEEN cast(#{beginTime} as VARCHAR) and cast(#{endTime} as VARCHAR)
    </if>
    ORDER BY
    <choose>
      <when test="sidx != null and sidx != ''">
        ${sidx} ${sord}
      </when>
      <otherwise>
        t.create_time DESC
      </otherwise>
    </choose>
  </select>
  
  <select id="findDateStaticById" resultMap="BaseResultMap" parameterType="java.lang.Integer">
    select
    <include refid="Base_Column_List" />
    from data_static
    where static_id = #{staticId,jdbcType=INTEGER}
  </select>
</mapper>