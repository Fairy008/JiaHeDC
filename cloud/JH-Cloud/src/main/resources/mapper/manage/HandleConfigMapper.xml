<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jh.produce.process.mapping.IHandleConfigMapper" >
  <resultMap id="BaseResultMap" type="com.jh.produce.process.entity.HandleConfig" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="handle_meta_id" property="handleMetaId" jdbcType="INTEGER" />
    <result column="data_status" property="dataStatus" jdbcType="CHAR" />
    <result column="del_flag" property="delFlag" jdbcType="CHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="creator_name" property="creatorName" jdbcType="VARCHAR" />
    <result column="creator" property="creator" jdbcType="INTEGER" />
    <result column="modify_time" property="modifyTime" jdbcType="TIMESTAMP" />
    <result column="modifier_name" property="modifierName" jdbcType="VARCHAR" />
    <result column="modifier" property="modifier" jdbcType="INTEGER" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="handle_meta_name" property="handleMetaName" jdbcType="VARCHAR" />
    <result column="handle_meta_class" property="handleMetaClass" jdbcType="VARCHAR" />
    <result column="handle_meta_params" property="handleMetaParams" jdbcType="VARCHAR" />
    <result column="io_type" property="ioType" jdbcType="CHAR" />
    <result column="handle_method_name" property="handleMethodName" jdbcType="VARCHAR"/>
    <result column="handle_file_paramname" property="handleFileParamname" jdbcType="VARCHAR"/>
  </resultMap>
  <sql id="Base_Column_List" >
    handle_meta_id, data_status, del_flag, create_time, creator_name, creator, modify_time,
    modifier_name, modifier, remark, handle_meta_name, handle_meta_class,
    handle_meta_params, io_type,handle_method_name,handle_file_paramname
  </sql>

  <select id="findByPage" resultMap="BaseResultMap" parameterType="HandleConfigParam">
    select
    <include refid="Base_Column_List" />
    from pro_handle_config where del_flag = '1' order by modifier_name desc, handle_meta_id
  </select>

  <select id="getById" resultMap="BaseResultMap" parameterType="java.lang.Integer">
    select
    <include refid="Base_Column_List" />
    from pro_handle_config
    where handle_meta_id = #{handleMetaId,jdbcType=INTEGER}
  </select>

  <insert id="save" parameterType="com.jh.produce.process.entity.HandleConfig" >
    insert into pro_handle_config
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="dataStatus != null" >
        data_status,
      </if>
      <if test="createTime != null" >
        create_time,
      </if>
      <if test="creatorName != null" >
        creator_name,
      </if>
      <if test="creator != null" >
        creator,
      </if>
      <if test="remark != null" >
        remark,
      </if>
      <if test="handleMetaName != null" >
        handle_meta_name,
      </if>
      <if test="handleMetaClass != null" >
        handle_meta_class,
      </if>
      <if test="handleMetaParams != null" >
        handle_meta_params,
      </if>
      <if test="ioType != null" >
        io_type,
      </if>
      <if test="handleMethodName != null">
        handle_method_name,
      </if>
      <if test="handleFileParamname != null">
        handle_file_paramname,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="dataStatus != null" >
        #{dataStatus,jdbcType=CHAR},
      </if>
      <if test="createTime != null" >
        now(),
      </if>
      <if test="creatorName != null" >
        #{creatorName,jdbcType=VARCHAR},
      </if>
      <if test="creator != null" >
        #{creator,jdbcType=INTEGER},
      </if>
      <if test="remark != null" >
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="handleMetaName != null" >
        #{handleMetaName,jdbcType=VARCHAR},
      </if>
      <if test="handleMetaClass != null" >
        #{handleMetaClass,jdbcType=VARCHAR},
      </if>
      <if test="handleMetaParams != null" >
        #{handleMetaParams,jdbcType=VARCHAR},
      </if>
      <if test="ioType != null" >
        #{ioType,jdbcType=CHAR},
      </if>
      <if test="handleMethodName != null">
        #{handleMethodName,jdbcType=VARCHAR},
      </if>
      <if test="handleFileParamname != null">
        #{handleFileParamname,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="update" parameterType="com.jh.produce.process.entity.HandleConfig" >
    update pro_handle_config
    <set >
      <if test="modifyTime != null" >
        modify_time = now(),
      </if>
      <if test="dataStatus != null" >
        data_status = #{dataStatus,jdbcType=CHAR},
      </if>
      <if test="modifierName != null" >
        modifier_name = #{modifierName,jdbcType=VARCHAR},
      </if>
      <if test="modifier != null" >
        modifier = #{modifier,jdbcType=INTEGER},
      </if>
      <if test="remark != null" >
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="handleMetaName != null" >
        handle_meta_name = #{handleMetaName,jdbcType=VARCHAR},
      </if>
      <if test="handleMetaClass != null" >
        handle_meta_class = #{handleMetaClass,jdbcType=VARCHAR},
      </if>
      <if test="handleMetaParams != null" >
        handle_meta_params = #{handleMetaParams,jdbcType=VARCHAR},
      </if>
      <if test="ioType != null" >
        io_type = #{ioType,jdbcType=CHAR},
      </if>
      <if test="handleMethodName != null">
        handle_method_name = #{handleMethodName,jdbcType=VARCHAR},
      </if>
      <if test="handleFileParamname != null">
        handle_file_paramname = #{handleFileParamname,jdbcType=VARCHAR},
      </if>
    </set>
    where handle_meta_id = #{handleMetaId,jdbcType=INTEGER}
  </update>

  <!--删除数据，逻辑删除-->
  <update id="delete" parameterType="Integer">
    update pro_handle_config
    <set >
      del_flag = '0',
    <if test="modifyTime != null" >
      modify_time = now(),
    </if>
    <if test="modifierName != null" >
      modifier_name = #{modifierName,jdbcType=VARCHAR},
    </if>
    <if test="modifier != null" >
      modifier = #{modifier,jdbcType=INTEGER},
    </if>
    </set>
   where handle_meta_id = #{handleMetaId,jdbcType=INTEGER}
  </update>

  <!-- 查询算法配置分页记录
  @version <1> 2018-02-07 djh： Created.
  @version <1> 2018-02-09 djh： 修改查询条件.
  -->
  <select id="queryByPage" resultType="HandleConfigParam" parameterType="HandleConfigParam">
    select
      DISTINCT(a.handle_meta_id) handleMetaId, a.handle_meta_name handleMetaName,
      a.data_status dataStatus, (case  when a.data_status = '1' then '正常' else '禁用' end) dataStatusName,
      handle_meta_class handleMetaClass, handle_meta_params handleMetaParams,a.modify_time,
      a.io_type ioType, c.data_name ioTypeName,a.handle_method_name AS handleMethodName,a.handle_file_paramname AS handleFileParamname
    from pro_handle_config a
    left join init_dict c on a.io_type = c.dict_id
    left join pro_relate_handle_sat d on a.handle_meta_id=d.handle_meta_id
    where a.del_flag = '1'
    <if test="satId !=null and satId!=''">
      and d.sat_id=#{satId,jdbcType=INTEGER}
    </if>
    <if test="handleMetaName != null and handleMetaName != ''" >
      and a.handle_meta_name like '%' || #{handleMetaName,jdbcType=VARCHAR} || '%'
    </if>
    <if test="dataStatus != null and dataStatus != ''" >
      and a.data_status = #{dataStatus,jdbcType=CHAR}
    </if>
    order by a.modify_time desc, a.handle_meta_id
  </select>

  <select id="findHandleConfigByIdList" parameterType="java.util.List" resultMap="BaseResultMap">
    SELECT <include refid="Base_Column_List" /> FROM pro_handle_config
    where handle_meta_id in (
    <foreach collection="handleConfigList" item="item" separator=",">
      #{item}
    </foreach>
    )
    order by handle_meta_id asc
  </select>

  <select id="findHandleConfigListBySatId" resultMap="BaseResultMap" parameterType="java.lang.Integer">
    select <include refid="Base_Column_List" /> from pro_handle_config where handle_meta_id in (
      select handle_meta_id from pro_relate_handle_sat where sat_id = #{satId}
    )  order by handle_meta_id asc
  </select>

  <select id="findHandlesBySatId" resultMap="BaseResultMap" parameterType="java.lang.Integer">
    select <include refid="Base_Column_List" /> from pro_handle_config where handle_meta_id in (
    select handle_meta_id from pro_relate_handle_sat where sat_id = #{satId} AND data_status = '1' AND del_flag = '1'
    )  order by handle_meta_id asc
  </select>


  <delete id="saveRelateHandleSat" parameterType="java.util.List">
    insert into pro_relate_handle_sat (handle_meta_id,sat_id) values
    <foreach collection="stats" item="stat" separator=",">
      (#{stat.handleMetaId},#{stat.satId})
    </foreach>
  </delete>

  <delete id="deleteRelateHandleSatByHandleMetaId" parameterType="java.lang.Integer">
    delete from pro_relate_handle_sat where handle_meta_id = #{handleMetaId}
  </delete>

  <select id="findRelateHandleSatByHandleMetaId" resultType="java.util.HashMap" parameterType="java.lang.Integer">
    select handle_meta_id handleMetaId,sat_id satId from pro_relate_handle_sat where handle_meta_id = #{handleMetaId}
  </select>
</mapper>