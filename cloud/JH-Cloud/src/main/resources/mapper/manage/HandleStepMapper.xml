<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jh.produce.process.mapping.IHandleStepMapper" >
  <resultMap id="BaseResultMap" type="com.jh.produce.process.entity.HandleStep" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="handle_detail_id" property="handleDetailId" jdbcType="INTEGER" />
    <result column="handle_id" property="handleId" jdbcType="BIGINT" />
    <result column="handle_meta_id" property="handleMetaId" jdbcType="BIGINT" />
    <result column="step_index" property="stepIndex" jdbcType="INTEGER" />
    <result column="step_param" property="stepParam" jdbcType="VARCHAR" />
    <result column="handle_status" property="handleStatus" jdbcType="VARCHAR" />
    <result column="start_time" property="startTime" jdbcType="TIMESTAMP" />
    <result column="end_time" property="endTime" jdbcType="TIMESTAMP" />
    <result column="save_status" property="saveStatus" jdbcType="CHAR" />
    <result column="fail_reason" property="failReason" jdbcType="VARCHAR" />
    <result column="handle_status_cn" property="handleStatusCN" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    handle_detail_id, handle_id, handle_meta_id, step_index, step_param, handle_status, start_time, end_time,
    save_status, fail_reason,
    (select data_name from init_dict where del_flag = '1' and data_status = '1' and parent_id = 1000 and dict_id = handle_status) as handle_status_cn
  </sql>

  <insert id="save" parameterType="com.jh.produce.process.entity.HandleStep" useGeneratedKeys="true" keyProperty="handleDetailId">
    insert into pro_handle_step(handle_id,handle_meta_id,step_index,step_param,handle_status,start_time,end_time,fail_reason,save_status) values
      (
        #{handleId,jdbcType=INTEGER},
        #{handleMetaId,jdbcType=INTEGER},
        #{stepIndex,jdbcType=INTEGER},
        #{stepParam,jdbcType=VARCHAR},
        #{handleStatus,jdbcType=INTEGER},
        #{startTime,jdbcType=TIMESTAMP},
        #{endTime,jdbcType=TIMESTAMP},
        #{failReason,jdbcType=VARCHAR},
        #{saveStatus,jdbcType=BOOLEAN}
      )
  </insert>

  <select id="findListByHandleId" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select <include refid="Base_Column_List" /> from pro_handle_step where handle_id = #{handleId} order by handle_detail_id
  </select>

  <update id="updateHandleStepStatus" parameterType="com.jh.produce.process.entity.HandleData">
    update pro_handle_step set handle_status = #{handleStatus},fail_reason = null where handle_id = #{handleId}
  </update>
</mapper>