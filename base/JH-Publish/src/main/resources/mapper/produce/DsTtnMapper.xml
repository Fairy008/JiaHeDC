<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jh.data.mapping.IDsTtnMapper" >
  <resultMap id="BaseResultMap" type="com.jh.data.entity.DsTtn" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="region_id" property="regionId" jdbcType="BIGINT" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="data_status" property="dataStatus" jdbcType="CHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="creator_name" property="creatorName" jdbcType="VARCHAR" />
    <result column="creator" property="creator" jdbcType="BIGINT" />
    <result column="modify_time" property="modifyTime" jdbcType="TIMESTAMP" />
    <result column="modifier_name" property="modifierName" jdbcType="VARCHAR" />
    <result column="modifier" property="modifier" jdbcType="INTEGER" />
    <result column="nddi" property="nddi" jdbcType="NUMERIC" />
    <result column="nddi_min" property="nddiMin" jdbcType="NUMERIC" />
    <result column="nddi_max" property="nddiMax" jdbcType="NUMERIC" />
    <result column="nddi_stddev" property="nddiStddev" jdbcType="NUMERIC" />
    <result column="t" property="t" jdbcType="NUMERIC" />
    <result column="t_max" property="tMax" jdbcType="NUMERIC" />
    <result column="t_min" property="tMin" jdbcType="NUMERIC" />
    <result column="t_stddev" property="tStddev" jdbcType="NUMERIC" />
    <result column="trmm" property="trmm" jdbcType="NUMERIC" />
    <result column="trmm_max" property="trmmMax" jdbcType="NUMERIC" />
    <result column="trmm_min" property="trmmMin" jdbcType="NUMERIC" />
    <result column="trmm_stddev" property="trmmStddev" jdbcType="NUMERIC" />
    <result column="data_time" property="dataTime" jdbcType="TIMESTAMP" />
    <result column="publish_status" property="publishStatus" jdbcType="BIGINT" />
    <result column="publish_time" property="publishTime" jdbcType="TIMESTAMP" />
    <result column="publisher_name" property="publisherName" jdbcType="VARCHAR" />
    <result column="del_flag" property="delFlag" jdbcType="CHAR" />
    <result column="publisher" property="publisher" jdbcType="INTEGER" />
    <result column="data_type" property="dataType" jdbcType="BIGINT" />
    <result column="region_name" property="regionName" jdbcType="VARCHAR" />
    <result column="region_code" property="regionCode" jdbcType="VARCHAR" />
    <result column="dataType_value" property="dataTypeValue" jdbcType="VARCHAR" />
    <result column="resolution_value" property="resolutionValue" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, region_id, remark, data_status, create_time, creator_name, creator, modify_time, 
    modifier_name, modifier, nddi, nddi_min, nddi_max, nddi_stddev, t, t_max, t_min, 
    t_stddev, trmm, trmm_max, trmm_min, trmm_stddev, data_time, publish_status, publish_time, 
    publisher_name, del_flag, publisher, data_type
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from ds_ttn
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from ds_ttn
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.jh.data.entity.DsTtn" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into ds_ttn (id, region_id, remark, 
      data_status, create_time, creator_name, 
      creator, modify_time, modifier_name, 
      modifier, nddi, nddi_min, 
      nddi_max, nddi_stddev, t, 
      t_max, t_min, t_stddev, 
      trmm, trmm_max, trmm_min, 
      trmm_stddev, data_time, publish_status, 
      publish_time, publisher_name, del_flag, 
      publisher, data_type)
    values (#{id,jdbcType=INTEGER}, #{regionId,jdbcType=BIGINT}, #{remark,jdbcType=VARCHAR}, 
      #{dataStatus,jdbcType=CHAR}, #{createTime,jdbcType=TIMESTAMP}, #{creatorName,jdbcType=VARCHAR}, 
      #{creator,jdbcType=BIGINT}, #{modifyTime,jdbcType=TIMESTAMP}, #{modifierName,jdbcType=VARCHAR}, 
      #{modifier,jdbcType=INTEGER}, #{nddi,jdbcType=NUMERIC}, #{nddiMin,jdbcType=NUMERIC}, 
      #{nddiMax,jdbcType=NUMERIC}, #{nddiStddev,jdbcType=NUMERIC}, #{t,jdbcType=NUMERIC}, 
      #{tMax,jdbcType=NUMERIC}, #{tMin,jdbcType=NUMERIC}, #{tStddev,jdbcType=NUMERIC}, 
      #{trmm,jdbcType=NUMERIC}, #{trmmMax,jdbcType=NUMERIC}, #{trmmMin,jdbcType=NUMERIC}, 
      #{trmmStddev,jdbcType=NUMERIC}, #{dataTime,jdbcType=TIMESTAMP}, #{publishStatus,jdbcType=BIGINT}, 
      #{publishTime,jdbcType=TIMESTAMP}, #{publisherName,jdbcType=VARCHAR}, #{delFlag,jdbcType=CHAR}, 
      #{publisher,jdbcType=INTEGER}, #{dataType,jdbcType=BIGINT})
  </insert>
  <insert id="insertSelective" parameterType="com.jh.data.entity.DsTtn" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into ds_ttn
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="regionId != null" >
        region_id,
      </if>
      <if test="remark != null" >
        remark,
      </if>
      <if test="dataStatus != null" >
        data_status,
      </if>
      <if test="createTime != null" >
        create_time,
      </if>
      <if test="creatorName != null" >
        creator_name,
      </if>
      <if test="creator != null" >
        creator,
      </if>
      <if test="modifyTime != null" >
        modify_time,
      </if>
      <if test="modifierName != null" >
        modifier_name,
      </if>
      <if test="modifier != null" >
        modifier,
      </if>
      <if test="nddi != null" >
        nddi,
      </if>
      <if test="nddiMin != null" >
        nddi_min,
      </if>
      <if test="nddiMax != null" >
        nddi_max,
      </if>
      <if test="nddiStddev != null" >
        nddi_stddev,
      </if>
      <if test="t != null" >
        t,
      </if>
      <if test="tMax != null" >
        t_max,
      </if>
      <if test="tMin != null" >
        t_min,
      </if>
      <if test="tStddev != null" >
        t_stddev,
      </if>
      <if test="trmm != null" >
        trmm,
      </if>
      <if test="trmmMax != null" >
        trmm_max,
      </if>
      <if test="trmmMin != null" >
        trmm_min,
      </if>
      <if test="trmmStddev != null" >
        trmm_stddev,
      </if>
      <if test="dataTime != null" >
        data_time,
      </if>
      <if test="publishStatus != null" >
        publish_status,
      </if>
      <if test="publishTime != null" >
        publish_time,
      </if>
      <if test="publisherName != null" >
        publisher_name,
      </if>
      <if test="delFlag != null" >
        del_flag,
      </if>
      <if test="publisher != null" >
        publisher,
      </if>
      <if test="dataType != null" >
        data_type,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="regionId != null" >
        #{regionId,jdbcType=BIGINT},
      </if>
      <if test="remark != null" >
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="dataStatus != null" >
        #{dataStatus,jdbcType=CHAR},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="creatorName != null" >
        #{creatorName,jdbcType=VARCHAR},
      </if>
      <if test="creator != null" >
        #{creator,jdbcType=BIGINT},
      </if>
      <if test="modifyTime != null" >
        #{modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modifierName != null" >
        #{modifierName,jdbcType=VARCHAR},
      </if>
      <if test="modifier != null" >
        #{modifier,jdbcType=INTEGER},
      </if>
      <if test="nddi != null" >
        #{nddi,jdbcType=NUMERIC},
      </if>
      <if test="nddiMin != null" >
        #{nddiMin,jdbcType=NUMERIC},
      </if>
      <if test="nddiMax != null" >
        #{nddiMax,jdbcType=NUMERIC},
      </if>
      <if test="nddiStddev != null" >
        #{nddiStddev,jdbcType=NUMERIC},
      </if>
      <if test="t != null" >
        #{t,jdbcType=NUMERIC},
      </if>
      <if test="tMax != null" >
        #{tMax,jdbcType=NUMERIC},
      </if>
      <if test="tMin != null" >
        #{tMin,jdbcType=NUMERIC},
      </if>
      <if test="tStddev != null" >
        #{tStddev,jdbcType=NUMERIC},
      </if>
      <if test="trmm != null" >
        #{trmm,jdbcType=NUMERIC},
      </if>
      <if test="trmmMax != null" >
        #{trmmMax,jdbcType=NUMERIC},
      </if>
      <if test="trmmMin != null" >
        #{trmmMin,jdbcType=NUMERIC},
      </if>
      <if test="trmmStddev != null" >
        #{trmmStddev,jdbcType=NUMERIC},
      </if>
      <if test="dataTime != null" >
        #{dataTime,jdbcType=TIMESTAMP},
      </if>
      <if test="publishStatus != null" >
        #{publishStatus,jdbcType=BIGINT},
      </if>
      <if test="publishTime != null" >
        #{publishTime,jdbcType=TIMESTAMP},
      </if>
      <if test="publisherName != null" >
        #{publisherName,jdbcType=VARCHAR},
      </if>
      <if test="delFlag != null" >
        #{delFlag,jdbcType=CHAR},
      </if>
      <if test="publisher != null" >
        #{publisher,jdbcType=INTEGER},
      </if>
      <if test="dataType != null" >
        #{dataType,jdbcType=BIGINT},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.jh.data.entity.DsTtn" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update ds_ttn
    <set >
      <if test="regionId != null" >
        region_id = #{regionId,jdbcType=BIGINT},
      </if>
      <if test="remark != null" >
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="dataStatus != null" >
        data_status = #{dataStatus,jdbcType=CHAR},
      </if>
      <if test="createTime != null" >
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="creatorName != null" >
        creator_name = #{creatorName,jdbcType=VARCHAR},
      </if>
      <if test="creator != null" >
        creator = #{creator,jdbcType=BIGINT},
      </if>
      <if test="modifyTime != null" >
        modify_time = #{modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modifierName != null" >
        modifier_name = #{modifierName,jdbcType=VARCHAR},
      </if>
      <if test="modifier != null" >
        modifier = #{modifier,jdbcType=INTEGER},
      </if>
      <if test="nddi != null" >
        nddi = #{nddi,jdbcType=NUMERIC},
      </if>
      <if test="nddiMin != null" >
        nddi_min = #{nddiMin,jdbcType=NUMERIC},
      </if>
      <if test="nddiMax != null" >
        nddi_max = #{nddiMax,jdbcType=NUMERIC},
      </if>
      <if test="nddiStddev != null" >
        nddi_stddev = #{nddiStddev,jdbcType=NUMERIC},
      </if>
      <if test="t != null" >
        t = #{t,jdbcType=NUMERIC},
      </if>
      <if test="tMax != null" >
        t_max = #{tMax,jdbcType=NUMERIC},
      </if>
      <if test="tMin != null" >
        t_min = #{tMin,jdbcType=NUMERIC},
      </if>
      <if test="tStddev != null" >
        t_stddev = #{tStddev,jdbcType=NUMERIC},
      </if>
      <if test="trmm != null" >
        trmm = #{trmm,jdbcType=NUMERIC},
      </if>
      <if test="trmmMax != null" >
        trmm_max = #{trmmMax,jdbcType=NUMERIC},
      </if>
      <if test="trmmMin != null" >
        trmm_min = #{trmmMin,jdbcType=NUMERIC},
      </if>
      <if test="trmmStddev != null" >
        trmm_stddev = #{trmmStddev,jdbcType=NUMERIC},
      </if>
      <if test="dataTime != null" >
        data_time = #{dataTime,jdbcType=TIMESTAMP},
      </if>
      <if test="publishStatus != null" >
        publish_status = #{publishStatus,jdbcType=BIGINT},
      </if>
      <if test="publishTime != null" >
        publish_time = #{publishTime,jdbcType=TIMESTAMP},
      </if>
      <if test="publisherName != null" >
        publisher_name = #{publisherName,jdbcType=VARCHAR},
      </if>
      <if test="delFlag != null" >
        del_flag = #{delFlag,jdbcType=CHAR},
      </if>
      <if test="publisher != null" >
        publisher = #{publisher,jdbcType=INTEGER},
      </if>
      <if test="dataType != null" >
        data_type = #{dataType,jdbcType=BIGINT},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.jh.data.entity.DsTtn" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update ds_ttn
    set region_id = #{regionId,jdbcType=BIGINT},
      remark = #{remark,jdbcType=VARCHAR},
      data_status = #{dataStatus,jdbcType=CHAR},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      creator_name = #{creatorName,jdbcType=VARCHAR},
      creator = #{creator,jdbcType=BIGINT},
      modify_time = #{modifyTime,jdbcType=TIMESTAMP},
      modifier_name = #{modifierName,jdbcType=VARCHAR},
      modifier = #{modifier,jdbcType=INTEGER},
      nddi = #{nddi,jdbcType=NUMERIC},
      nddi_min = #{nddiMin,jdbcType=NUMERIC},
      nddi_max = #{nddiMax,jdbcType=NUMERIC},
      nddi_stddev = #{nddiStddev,jdbcType=NUMERIC},
      t = #{t,jdbcType=NUMERIC},
      t_max = #{tMax,jdbcType=NUMERIC},
      t_min = #{tMin,jdbcType=NUMERIC},
      t_stddev = #{tStddev,jdbcType=NUMERIC},
      trmm = #{trmm,jdbcType=NUMERIC},
      trmm_max = #{trmmMax,jdbcType=NUMERIC},
      trmm_min = #{trmmMin,jdbcType=NUMERIC},
      trmm_stddev = #{trmmStddev,jdbcType=NUMERIC},
      data_time = #{dataTime,jdbcType=TIMESTAMP},
      publish_status = #{publishStatus,jdbcType=BIGINT},
      publish_time = #{publishTime,jdbcType=TIMESTAMP},
      publisher_name = #{publisherName,jdbcType=VARCHAR},
      del_flag = #{delFlag,jdbcType=CHAR},
      publisher = #{publisher,jdbcType=INTEGER},
      data_type = #{dataType,jdbcType=BIGINT}
    where id = #{id,jdbcType=INTEGER}
  </update>
  
  <select id="findDsTtnldReportCreateData" resultMap="BaseResultMap" parameterType="com.jh.data.model.ReportCreateParam">
      SELECT
          t.id,
          t.region_id,
          t.remark,
          t.data_status,
          t.create_time,
          t.creator_name,
          t.creator,
          t.modify_time,
          t.modifier_name,
          t.modifier,
          t.nddi,
          t.nddi_min,
          t.nddi_max,
          t.nddi_stddev,
          t.t,
          t.t_max,
          t.t_min,
          t.t_stddev,
          t.trmm,
          t.trmm_max,
          t.trmm_min,
          t.trmm_stddev,
          t.data_time,
          t.publish_status,
          t.publish_time,
          t.publisher_name,
          t.del_flag,
          t.publisher,
          t.data_type,
          r.china_name AS region_name,
          r.region_code AS region_code,
          (select data_name from init_dict where init_dict.parent_id = 4000 and init_dict.dict_id = t.resolution AND init_dict.data_status = '1' AND init_dict.del_flag = '1') as resolution_value
      FROM
          ( SELECT * FROM ds_ttn WHERE data_status = '1' AND del_flag = '1' AND publish_status = 2201
              <if test="resolution!=null and resolution!=''">
                AND resolution = #{resolution,jdbcType=INTEGER}
              </if>
              <if test="startTime != null and startTime != '' and endTime != null and endTime != ''">
                AND to_char(to_date(cast(data_time as varchar),'yyyy-mm-dd'), 'yyyy-mm-dd') BETWEEN cast(#{startTime} as VARCHAR) and cast(#{endTime} as VARCHAR)
              </if>
          ) t,
          ( SELECT * FROM init_region WHERE data_status = '1' AND del_flag = '1'
            <if test="regionId!=null and regionId!=''">
              AND (region_id = #{regionId,jdbcType=INTEGER} OR parent_id = #{regionId,jdbcType=INTEGER})
            </if>) r
      WHERE
          t.region_id = r.region_id
          <if test="dataSet==1804">
            AND t.t IS NOT NULL
          </if>
          <if test="dataSet==1805">
            AND t.trmm IS NOT NULL
          </if>
          <if test="dataSet==1806">
            AND t.nddi IS NOT NULL
          </if>
      ORDER BY t.region_id, t.ID
  </select>

  <select id="findByPage" resultMap="BaseResultMap" parameterType="com.jh.data.model.DsTtnParam" >
    SELECT
    T.ID,
    T.region_id,
    T.remark,
    T.data_status,
    T.create_time,
    T.creator_name,
    T.creator,
    T.modify_time,
    T.modifier_name,
    T.modifier,
    T.nddi,
    T.nddi_min,
    T.nddi_max,
    T.nddi_stddev,
    T,
    T.t_max,
    T.t_min,
    T.t_stddev,
    T.trmm,
    T.trmm_max,
    T.trmm_min,
    T.trmm_stddev,
    T.data_time,
    T.publish_status,
    T.publish_time,
    T.publisher_name,
    T.del_flag,
    T.publisher,
    T.data_type,
    d.data_name AS resolution_value,
    r.china_name AS region_name,
    r.region_code AS region_code
    FROM
    ds_ttn T
    LEFT JOIN init_dict d ON d.parent_id = 4000
    AND d.dict_id = T.resolution
    AND d.del_flag = '1'
    AND d.data_status = '1'
    LEFT JOIN init_region r ON t.region_id = r.region_id
    AND r.del_flag = '1'
    AND r.data_status = '1'
    WHERE
    T.del_flag = '1'
    AND T.data_status = '1'
    <if test="id!=null and id!=''">
      AND T.id = #{id,jdbcType=INTEGER}
    </if>
    <if test="regionId!=null and regionId!=''">
      AND  T.region_id = #{regionId,jdbcType=INTEGER}
    </if>
    <if test="dataType!=null and dataType!=''">
      AND  T.data_type = #{dataType,jdbcType=INTEGER}
    </if>
    <if test="publishStatus!=null and publishStatus!=''">
      AND  T.publish_status = #{publishStatus,jdbcType=INTEGER}
    </if>
    <if test="publisherName!=null and publisherName!=''">
      AND  publisher_name like CONCAT('%', #{publisherName}, '%')
    </if>
    <if test="dataSet==1804">
      AND t.t IS NOT NULL
    </if>
    <if test="dataSet==1805">
      AND t.trmm IS NOT NULL
    </if>
    <if test="dataSet==1806">
      AND t.nddi IS NOT NULL
    </if>
    ORDER BY t.region_id, t.id
  </select>

  <update id="updateDsTtn" parameterType="com.jh.data.model.DsTtnParam">
    update  ds_ttn
    <set >
      <if test="regionId != null" > region_id = #{regionId}, </if>
      <if test="remark != null" > remark = #{remark},</if>
      <if test="dataStatus != null" > data_status = #{dataStatus},</if>
      <if test="delFlag != null" > del_flag = #{delFlag}, </if>
      modify_time = now(),
      <if test="modifierName != null" > modifier_name = #{modifierName},</if>
      <if test="modifier != null" > modifier = #{modifier}, </if>
      <if test="nddi != null" > nddi = #{nddi}, </if>
      <if test="nddiMin != null" > nddi_min = #{nddiMin}, </if>
      <if test="nddiMax != null" > nddi_max = #{nddiMax}, </if>
      <if test="nddiStddev != null" > nddi_stddev = #{nddiStddev}, </if>
      <if test="t != null" > t = #{t}, </if>
      <if test="tMin != null" > t_min = #{tMin}, </if>
      <if test="tMax != null" > t_max = #{tMax}, </if>
      <if test="tStddev != null" > t_stddev = #{tStddev}, </if>
      <if test="trmm != null" > trmm = #{trmm}, </if>
      <if test="trmmMin != null" > trmm_min = #{trmmMin}, </if>
      <if test="trmmMax != null" > trmm_max = #{trmmMax}, </if>
      <if test="trmmStddev != null" > trmm_stddev = #{trmmStddev}, </if>
      <if test="dataTime != null" > data_time = #{dataTime}, </if>
      <if test="dataType != null" > data_type = #{dataType}, </if>
      <if test="publishStatus != null" > publish_status = #{publishStatus}, </if>
      <if test="publishTime != null" > publish_time = #{publishTime}, </if>
      <if test="publisherName != null" > publish_name = #{publishName}, </if>
      <if test="publisher != null" > publisher = #{publisher}, </if>
    </set>
    where 1=1
    <if test="id!=null and id!=''">
      AND  id = #{id,jdbcType=INTEGER}
    </if>
    <if test="regionId!=null and regionId!=''">
      AND  regionId = #{regionId,jdbcType=BIGINT}
    </if>
    <if test="dataType!=null and dataType!=''">
      AND  data_type = #{dataType,jdbcType=INTEGER}
    </if>
    <if test="cropId!=null and cropId!=''">
      AND  cropId = #{cropId,jdbcType=INTEGER}
    </if>
    <if test="dataTime!=null and dataTime!=''">
      AND  data_time = #{dataTime,jdbcType=DATE}
    </if>
    <if test="creator!=null and creator!=''">
      AND  creator = #{creator,jdbcType=INTEGER}
    </if>
    <if test="publisher!=null and publisher!=''">
      AND  publisher = #{publisher,jdbcType=INTEGER}
    </if>
    <if test="publishStatus!=null and publishStatus!=''">
      AND  publisher_status = #{publishStatus,jdbcType=INTEGER}
    </if>
  </update>

  <select id="findById" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    SELECT
    T.ID,
    T.region_id,
    T.remark,
    T.data_status,
    T.create_time,
    T.creator_name,
    T.creator,
    T.modify_time,
    T.modifier_name,
    T.modifier,
    T.nddi,
    T.nddi_min,
    T.nddi_max,
    T.nddi_stddev,
    T,
    T.t_max,
    T.t_min,
    T.t_stddev,
    T.trmm,
    T.trmm_max,
    T.trmm_min,
    T.trmm_stddev,
    T.data_time,
    T.publish_status,
    T.publish_time,
    T.publisher_name,
    T.del_flag,
    T.publisher,
    T.data_type,
    d.data_name AS resolution_value,
    r.china_name AS region_name,
    r.region_code AS region_code
    FROM
    ds_ttn T
    LEFT JOIN init_dict d ON d.parent_id = 4000
    AND d.dict_id = T.resolution
    AND d.del_flag = '1'
    AND d.data_status = '1'
    LEFT JOIN init_region r ON t.region_id = r.region_id
    AND r.del_flag = '1'
    AND r.data_status = '1'
    WHERE
    T.del_flag = '1'
    AND T.data_status = '1'
    AND T.publish_status=2202
    AND T.id = #{id,jdbcType=INTEGER}
  </select>
  <update id="publish" parameterType="java.util.Map" >
    update  ds_ttn
    <set >
      <if test="publishStatus != null" > publish_status = #{publishStatus}, </if>
      publish_time  = now(),
      <if test="publisherName != null" > publisher_name = #{publisherName}, </if>
      <if test="publisher != null" > publisher = #{publisher}, </if>
    </set>
    where id in
    <foreach collection="idList" index="index" item="item" open="(" separator="," close=")">
      #{item}
    </foreach>
  </update>

  <!--
     查询指定时间类上中下旬的雨量总和和地温的均值
     @param TtnParam : 参数，（区域ID，起止日期）
     @return List<TenDaysTrmmDataReturn> : 上中下旬雨量总和和地温均值
     @version <1> 2018-03-22 lxy: Created.
     @version <2> 2018-06-27 cxw: update:降雨地温表拆分后更改sql联合查询
   -->
  <select id="findTrmmAndTempByTenDays" resultType="com.jh.data.model.TenDaysTrmmDataReturn" parameterType="com.jh.data.model.TtnParam" >

    select m.regionId,m.level,m.regionName,m.date,m.waterFirst,m.waterSecond,m.waterThird,t.tempFirst,t.tempSecond,t.tempThird from
    (select region.region_id as regionId,region.level,region.china_name regionName,to_char(trm.data_time,'YYYY-MM') date,
    sum(case when date_part('DAY',trm.data_time) &lt;=10  then trmm end) waterFirst,
    sum(case when date_part('DAY',trm.data_time) >10 and date_part('DAY',trm.data_time) &lt;=20 then trmm end) waterSecond,
    sum(case when date_part('DAY',trm.data_time) >20 then trmm end) waterThird
    from ds_trmm trm left join init_region region on trm.region_id = region.region_id
    <where>
      <if test="#{regionId != null}">
        (region.region_id=#{regionId} or region.parent_id = #{regionId})
      </if>
      <if test="#{startDate != null and endDate != null}">
        and to_char(trm.data_time,'YYYY-MM')
        between
        to_char(cast(#{startDate} as timestamp),'YYYY-MM')
        and
        to_char(cast(#{endDate} as timestamp),'YYYY-MM')
      </if>
    </where>
    group by regionId,regionName,date) m
    left join
    (select
    region.region_id as regionId,region.level,region.china_name regionName,to_char(ttn.data_time,'YYYY-MM') date,
    round(avg(case when date_part('DAY',ttn.data_time)&lt;=10  and t>0 then t end),2) tempFirst,
    round(avg(case when date_part('DAY',ttn.data_time) >10 and date_part('DAY',ttn.data_time)&lt;=20 and t>0 then t end),2) tempSecond,
    round(avg(case when date_part('DAY',ttn.data_time) >20 and t>0 then t end),2) tempThird
    from ds_t ttn left join init_region region on ttn.region_id = region.region_id
    <where>
      <if test="#{regionId != null}">
        (region.region_id=#{regionId} or region.parent_id = #{regionId})
      </if>
      <if test="#{startDate != null and endDate != null}">
        and to_char(ttn.data_time,'YYYY-MM')
        between
        to_char(cast(#{startDate} as timestamp),'YYYY-MM')
        and
        to_char(cast(#{endDate} as timestamp),'YYYY-MM')
      </if>
    </where>
    group by regionId,regionName,date)  t on m.regionId = t.regionId and m.date = t.date
    order by regionName,date

  </select>

  <!--
    查询历史时间段上中下旬的雨量和地温均值
    @param TtnParam : 参数，（区域ID，起止日期）
    @return List<TenDaysTrmmDataReturn> : 历史时间段上中下旬雨量和地温均值
    @version <1> 2018-3-22 lxy: Created.
    @version <2> 2018-06-27 cxw: update:降雨地温表拆分后更改sql联合查询
  -->
  <select id="findHistoryAvgForTrmmAndTempTotal" resultType="com.jh.data.model.TenDaysTrmmDataReturn" parameterType="java.util.HashMap" >
    select m.waterFirstAvg,m.waterSecondAvg,m.waterThirdAvg,t.tempFirstAvg,t.tempSecondAvg,t.tempThirdAvg from (select
    round(avg(waterFirst),2) waterFirstAvg, round(avg(waterSecond),2) waterSecondAvg, round(avg(waterThird),2) waterThirdAvg
    from (select   region.region_id as regionId,to_char(trm.data_time,'YYYY') date,
    sum(case when date_part('MONTH',trm.data_time)=#{month} and date_part('DAY',trm.data_time) &lt;=10  then trmm end) as waterFirst,
    sum( case when date_part('MONTH',trm.data_time)=#{month} and date_part('DAY',trm.data_time) >10 and date_part('DAY',trm.data_time) &lt;=20
    then trmm end)waterSecond, sum(case when date_part('MONTH',trm.data_time)=#{month} and date_part('DAY',trm.data_time) >20 then trmm end
    ) waterThird  from ds_trmm trm left join init_region region on trm.region_id = region.region_id
    <where>
      <if test="#{regionId != null}">
        (region.region_id=#{regionId} or region.parent_id = #{regionId})
      </if>
      <if test="#{endDate != null}">
        and #{endDate}> to_char(trm.data_time,'YYYY')
      </if>
    </where>
    group by regionId,date) as temp) m,
    (select round(avg(tempFirst),2) tempFirstAvg, round(avg(tempSecond),2) tempSecondAvg, round(avg(tempThird),2) tempThirdAvg
    from (select  region.region_id as regionId,to_char(t.data_time,'YYYY') date,
    avg(case when date_part('MONTH',t.data_time)=#{month} and date_part('DAY',t.data_time)&lt;=10  then t else null end) as tempFirst,
    avg(case when date_part('MONTH',t.data_time)=#{month} and date_part('DAY',t.data_time) >10 and date_part('DAY',t.data_time)&lt;=20
    then t else null end ) tempSecond,  avg(case when date_part('MONTH',t.data_time)=#{month} and date_part('DAY',t.data_time) >20 then t else null end) tempThird
    from ds_t t left join init_region region on t.region_id = region.region_id
    <where>
      <if test="#{regionId != null}">
        (region.region_id=#{regionId} or region.parent_id = #{regionId})
      </if>
      <if test="#{endDate != null}">
        and #{endDate}> to_char(t.data_time,'YYYY')
      </if>
    </where>
    group by regionId,date
    ) as temp) t

  </select>

  <select id="queryDateTimeList" resultMap="BaseResultMap" parameterType="com.jh.data.model.ReportCreateParam">
    SELECT DISTINCT data_time FROM ds_ttn
    WHERE data_status = '1' AND del_flag = '1' AND publish_status = 2201
    <if test="regionId != null">
      AND region_id = #{regionId,jdbcType=INTEGER}
    </if>
    <if test="resolution != null">
      AND resolution = #{resolution,jdbcType=INTEGER}
    </if>
    ORDER BY data_time DESC
  </select>
</mapper>