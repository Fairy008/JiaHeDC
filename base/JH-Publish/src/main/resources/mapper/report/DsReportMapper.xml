<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jh.report.mapping.IDsReportMapper" >
  <resultMap id="BaseResultMap" type="com.jh.report.entity.DsReport">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="report_id" jdbcType="INTEGER" property="reportId" />
    <result column="data_status" jdbcType="CHAR" property="dataStatus" />
    <result column="del_flag" jdbcType="CHAR" property="delFlag" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="creator_name" jdbcType="VARCHAR" property="creatorName" />
    <result column="creator" jdbcType="INTEGER" property="creator" />
    <result column="modify_time" jdbcType="TIMESTAMP" property="modifyTime" />
    <result column="modifier_name" jdbcType="VARCHAR" property="modifierName" />
    <result column="modifier" jdbcType="INTEGER" property="modifier" />
    <result column="remark" jdbcType="VARCHAR" property="remark" />
    <result column="region_id" jdbcType="BIGINT" property="regionId" />
    <result column="report_name" jdbcType="VARCHAR" property="reportName" />
    <result column="file_showname" jdbcType="VARCHAR" property="fileShowname" />
    <result column="file_path" jdbcType="VARCHAR" property="filePath" />
    <result column="file_realname" jdbcType="VARCHAR" property="fileRealname" />
    <result column="file_size" jdbcType="VARCHAR" property="fileSize" />
    <result column="file_suffix" jdbcType="VARCHAR" property="fileSuffix" />
    <result column="cycle" jdbcType="BIGINT" property="cycle" />
    <result column="mechanism" jdbcType="BIGINT" property="mechanism" />
    <result column="crop_id" jdbcType="INTEGER" property="cropId" />
    <result column="publish_time" jdbcType="TIMESTAMP" property="publishTime" />
    <result column="data_type" jdbcType="INTEGER" property="dataType" />
    <result column="approval_status" jdbcType="INTEGER" property="approvalStatus" />
    <result column="ds_id" jdbcType="INTEGER" property="dsId" />
    <result column="report_time" jdbcType="DATE" property="reportTime" />
    <result column="publish_status" jdbcType="INTEGER" property="publishStatus" />
    <result column="publisher_name" jdbcType="VARCHAR" property="publisherName" />
    <result column="region_name" property="regionName" jdbcType="VARCHAR" />
    <result column="region_code" property="regionCode" jdbcType="VARCHAR" />
    <result column="crop_name" property="cropName" jdbcType="VARCHAR" />
    <result column="ds_name" property="dsName" jdbcType="VARCHAR" />
    <result column="resolution" property="resolution" jdbcType="INTEGER" />
    <result column="resolution_value" property="resolutionValue" jdbcType="VARCHAR" />
    <result column="approval_status_cn" property="approvalStatusCN" jdbcType="VARCHAR" />
    <result column="data_type_cn" property="dataTypeCN" jdbcType="VARCHAR" />
    <result column="publish_status_cn" property="publishStatusCN" jdbcType="VARCHAR" />
    <result column="keyword" property="keyword" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    report_id, data_status, del_flag, create_time, creator_name, creator, modify_time,
    modifier_name, modifier, remark, region_id, report_name, file_showname, file_path,
    file_realname, file_size, file_suffix, cycle, mechanism, crop_id, publish_time, data_type,
    approval_status, ds_id, report_time, publish_status, publisher_name,resolution,keyword,
    (select china_name from init_region where init_region.region_id = ds_report.region_id) as region_name,
    (select region_code from init_region where init_region.region_id = ds_report.region_id) as region_code,
    (select data_name from init_dict where init_dict.parent_id = 500 and init_dict.dict_id = ds_report.crop_id) as crop_name,
    (select data_name from init_dict where init_dict.parent_id = 1800 and init_dict.dict_id = ds_report.ds_id) as ds_name,
    (select data_name from init_dict where init_dict.parent_id = 9001 and init_dict.dict_id = ds_report.approval_status) as approval_status_cn,
    (select data_name from init_dict where init_dict.parent_id = 4000 and init_dict.dict_id = ds_report.resolution) as resolution_value,
    (select data_name from init_dict where init_dict.parent_id = 2200 and init_dict.dict_id = ds_report.publish_status) as publish_status_cn
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <include refid="Base_Column_List" />
    from ds_report
    where report_id = #{reportId,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from ds_report
    where report_id = #{reportId,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.jh.report.entity.DsReport">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into ds_report (report_id, data_status, del_flag,
    create_time, creator_name, creator,
    modify_time, modifier_name, modifier,
    remark, region_id, report_name,
    file_showname, file_path, file_realname,
    file_size, file_suffix, cycle,
    mechanism, crop_id, publish_time,
    data_type, approval_status, ds_id,
    report_time, publish_status, publisher_name
    )
    values (#{reportId,jdbcType=INTEGER}, #{dataStatus,jdbcType=CHAR}, #{delFlag,jdbcType=CHAR},
    #{createTime,jdbcType=TIMESTAMP}, #{creatorName,jdbcType=VARCHAR}, #{creator,jdbcType=INTEGER},
    #{modifyTime,jdbcType=TIMESTAMP}, #{modifierName,jdbcType=VARCHAR}, #{modifier,jdbcType=INTEGER},
    #{remark,jdbcType=VARCHAR}, #{regionId,jdbcType=BIGINT}, #{reportName,jdbcType=VARCHAR},
    #{fileShowname,jdbcType=VARCHAR}, #{filePath,jdbcType=VARCHAR}, #{fileRealname,jdbcType=VARCHAR},
    #{fileSize,jdbcType=VARCHAR}, #{fileSuffix,jdbcType=VARCHAR}, #{cycle,jdbcType=BIGINT},
    #{mechanism,jdbcType=BIGINT}, #{cropId,jdbcType=INTEGER}, #{publishTime,jdbcType=TIMESTAMP},
    #{dataType,jdbcType=INTEGER}, #{approvalStatus,jdbcType=INTEGER}, #{dsId,jdbcType=INTEGER},
    #{reportTime,jdbcType=DATE}, #{publishStatus,jdbcType=INTEGER}, #{publisherName,jdbcType=VARCHAR}
    )
  </insert>
  <insert id="insertSelective" parameterType="com.jh.report.entity.DsReport">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into ds_report
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="reportId != null">
        report_id,
      </if>
      <if test="dataStatus != null">
        data_status,
      </if>
      <if test="delFlag != null">
        del_flag,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="creatorName != null">
        creator_name,
      </if>
      <if test="creator != null">
        creator,
      </if>
      <if test="modifyTime != null">
        modify_time,
      </if>
      <if test="modifierName != null">
        modifier_name,
      </if>
      <if test="modifier != null">
        modifier,
      </if>
      <if test="remark != null">
        remark,
      </if>
      <if test="regionId != null">
        region_id,
      </if>
      <if test="reportName != null">
        report_name,
      </if>
      <if test="fileShowname != null">
        file_showname,
      </if>
      <if test="filePath != null">
        file_path,
      </if>
      <if test="fileRealname != null">
        file_realname,
      </if>
      <if test="fileSize != null">
        file_size,
      </if>
      <if test="fileSuffix != null">
        file_suffix,
      </if>
      <if test="cycle != null">
        cycle,
      </if>
      <if test="mechanism != null">
        mechanism,
      </if>
      <if test="cropId != null">
        crop_id,
      </if>
      <if test="publishTime != null">
        publish_time,
      </if>
      <if test="dataType != null">
        data_type,
      </if>
      <if test="approvalStatus != null">
        approval_status,
      </if>
      <if test="dsId != null">
        ds_id,
      </if>
      <if test="reportTime != null">
        report_time,
      </if>
      <if test="publishStatus != null">
        publish_status,
      </if>
      <if test="publisherName != null">
        publisher_name,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="reportId != null">
        #{reportId,jdbcType=INTEGER},
      </if>
      <if test="dataStatus != null">
        #{dataStatus,jdbcType=CHAR},
      </if>
      <if test="delFlag != null">
        #{delFlag,jdbcType=CHAR},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="creatorName != null">
        #{creatorName,jdbcType=VARCHAR},
      </if>
      <if test="creator != null">
        #{creator,jdbcType=INTEGER},
      </if>
      <if test="modifyTime != null">
        #{modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modifierName != null">
        #{modifierName,jdbcType=VARCHAR},
      </if>
      <if test="modifier != null">
        #{modifier,jdbcType=INTEGER},
      </if>
      <if test="remark != null">
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="regionId != null">
        #{regionId,jdbcType=BIGINT},
      </if>
      <if test="reportName != null">
        #{reportName,jdbcType=VARCHAR},
      </if>
      <if test="fileShowname != null">
        #{fileShowname,jdbcType=VARCHAR},
      </if>
      <if test="filePath != null">
        #{filePath,jdbcType=VARCHAR},
      </if>
      <if test="fileRealname != null">
        #{fileRealname,jdbcType=VARCHAR},
      </if>
      <if test="fileSize != null">
        #{fileSize,jdbcType=VARCHAR},
      </if>
      <if test="fileSuffix != null">
        #{fileSuffix,jdbcType=VARCHAR},
      </if>
      <if test="cycle != null">
        #{cycle,jdbcType=BIGINT},
      </if>
      <if test="mechanism != null">
        #{mechanism,jdbcType=BIGINT},
      </if>
      <if test="cropId != null">
        #{cropId,jdbcType=INTEGER},
      </if>
      <if test="publishTime != null">
        #{publishTime,jdbcType=TIMESTAMP},
      </if>
      <if test="dataType != null">
        #{dataType,jdbcType=INTEGER},
      </if>
      <if test="approvalStatus != null">
        #{approvalStatus,jdbcType=INTEGER},
      </if>
      <if test="dsId != null">
        #{dsId,jdbcType=INTEGER},
      </if>
      <if test="reportTime != null">
        #{reportTime,jdbcType=DATE},
      </if>
      <if test="publishStatus != null">
        #{publishStatus,jdbcType=INTEGER},
      </if>
      <if test="publisherName != null">
        #{publisherName,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.jh.report.entity.DsReport">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update ds_report
    <set>
      <if test="dataStatus != null">
        data_status = #{dataStatus,jdbcType=CHAR},
      </if>
      <if test="delFlag != null">
        del_flag = #{delFlag,jdbcType=CHAR},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="creatorName != null">
        creator_name = #{creatorName,jdbcType=VARCHAR},
      </if>
      <if test="creator != null">
        creator = #{creator,jdbcType=INTEGER},
      </if>
      <if test="modifyTime != null">
        modify_time = #{modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modifierName != null">
        modifier_name = #{modifierName,jdbcType=VARCHAR},
      </if>
      <if test="modifier != null">
        modifier = #{modifier,jdbcType=INTEGER},
      </if>
      <if test="remark != null">
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="regionId != null">
        region_id = #{regionId,jdbcType=BIGINT},
      </if>
      <if test="reportName != null">
        report_name = #{reportName,jdbcType=VARCHAR},
      </if>
      <if test="fileShowname != null">
        file_showname = #{fileShowname,jdbcType=VARCHAR},
      </if>
      <if test="filePath != null">
        file_path = #{filePath,jdbcType=VARCHAR},
      </if>
      <if test="fileRealname != null">
        file_realname = #{fileRealname,jdbcType=VARCHAR},
      </if>
      <if test="fileSize != null">
        file_size = #{fileSize,jdbcType=VARCHAR},
      </if>
      <if test="fileSuffix != null">
        file_suffix = #{fileSuffix,jdbcType=VARCHAR},
      </if>
      <if test="cycle != null">
        cycle = #{cycle,jdbcType=BIGINT},
      </if>
      <if test="mechanism != null">
        mechanism = #{mechanism,jdbcType=BIGINT},
      </if>
      <if test="cropId != null">
        crop_id = #{cropId,jdbcType=INTEGER},
      </if>
      <if test="publishTime != null">
        publish_time = #{publishTime,jdbcType=TIMESTAMP},
      </if>
      <if test="dataType != null">
        data_type = #{dataType,jdbcType=INTEGER},
      </if>
      <if test="approvalStatus != null">
        approval_status = #{approvalStatus,jdbcType=INTEGER},
      </if>
      <if test="dsId != null">
        ds_id = #{dsId,jdbcType=INTEGER},
      </if>
      <if test="reportTime != null">
        report_time = #{reportTime,jdbcType=DATE},
      </if>
      <if test="publishStatus != null">
        publish_status = #{publishStatus,jdbcType=INTEGER},
      </if>
      <if test="publisherName != null">
        publisher_name = #{publisherName,jdbcType=VARCHAR},
      </if>
    </set>
    where report_id = #{reportId,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.jh.report.entity.DsReport">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update ds_report
    set data_status = #{dataStatus,jdbcType=CHAR},
    del_flag = #{delFlag,jdbcType=CHAR},
    create_time = #{createTime,jdbcType=TIMESTAMP},
    creator_name = #{creatorName,jdbcType=VARCHAR},
    creator = #{creator,jdbcType=INTEGER},
    modify_time = #{modifyTime,jdbcType=TIMESTAMP},
    modifier_name = #{modifierName,jdbcType=VARCHAR},
    modifier = #{modifier,jdbcType=INTEGER},
    remark = #{remark,jdbcType=VARCHAR},
    region_id = #{regionId,jdbcType=BIGINT},
    report_name = #{reportName,jdbcType=VARCHAR},
    file_showname = #{fileShowname,jdbcType=VARCHAR},
    file_path = #{filePath,jdbcType=VARCHAR},
    file_realname = #{fileRealname,jdbcType=VARCHAR},
    file_size = #{fileSize,jdbcType=VARCHAR},
    file_suffix = #{fileSuffix,jdbcType=VARCHAR},
    cycle = #{cycle,jdbcType=BIGINT},
    mechanism = #{mechanism,jdbcType=BIGINT},
    crop_id = #{cropId,jdbcType=INTEGER},
    publish_time = #{publishTime,jdbcType=TIMESTAMP},
    data_type = #{dataType,jdbcType=INTEGER},
    approval_status = #{approvalStatus,jdbcType=INTEGER},
    ds_id = #{dsId,jdbcType=INTEGER},
    report_time = #{reportTime,jdbcType=DATE},
    publish_status = #{publishStatus,jdbcType=INTEGER},
    publisher_name = #{publisherName,jdbcType=VARCHAR}
    where report_id = #{reportId,jdbcType=INTEGER}
  </update>

  <insert id="saveReportInfo" parameterType="com.jh.report.entity.DsReport" >
    insert into ds_report
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="reportId != null">
        report_id,
      </if>
      <if test="dataStatus != null">
        data_status,
      </if>
      <if test="delFlag != null">
        del_flag,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="creatorName != null">
        creator_name,
      </if>
      <if test="creator != null">
        creator,
      </if>
      <if test="modifyTime != null">
        modify_time,
      </if>
      <if test="modifierName != null">
        modifier_name,
      </if>
      <if test="modifier != null">
        modifier,
      </if>
      <if test="remark != null">
        remark,
      </if>
      <if test="regionId != null">
        region_id,
      </if>
      <if test="reportName != null">
        report_name,
      </if>
      <if test="fileShowname != null">
        file_showname,
      </if>
      <if test="filePath != null">
        file_path,
      </if>
      <if test="fileRealname != null">
        file_realname,
      </if>
      <if test="fileSize != null">
        file_size,
      </if>
      <if test="fileSuffix != null">
        file_suffix,
      </if>
      <if test="cycle != null">
        cycle,
      </if>
      <if test="mechanism != null">
        mechanism,
      </if>
      <if test="cropId != null">
        crop_id,
      </if>
      <if test="publishTime != null">
        publish_time,
      </if>
      <if test="dataType != null">
        data_type,
      </if>
      <if test="approvalStatus != null">
        approval_status,
      </if>
      <if test="dsId != null">
        ds_id,
      </if>
      <if test="reportTime != null">
        report_time,
      </if>
      <if test="publishStatus != null">
        publish_status,
      </if>
      <if test="publisherName != null">
        publisher_name,
      </if>
      <if test="resolution != null">
        resolution,
      </if>
      <if test="keyword != null">
        keyword,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="reportId != null">
        #{reportId,jdbcType=INTEGER},
      </if>
      <if test="dataStatus != null">
        #{dataStatus,jdbcType=CHAR},
      </if>
      <if test="delFlag != null">
        #{delFlag,jdbcType=CHAR},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="creatorName != null">
        #{creatorName,jdbcType=VARCHAR},
      </if>
      <if test="creator != null">
        #{creator,jdbcType=INTEGER},
      </if>
      <if test="modifyTime != null">
        #{modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modifierName != null">
        #{modifierName,jdbcType=VARCHAR},
      </if>
      <if test="modifier != null">
        #{modifier,jdbcType=INTEGER},
      </if>
      <if test="remark != null">
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="regionId != null">
        #{regionId,jdbcType=BIGINT},
      </if>
      <if test="reportName != null">
        #{reportName,jdbcType=VARCHAR},
      </if>
      <if test="fileShowname != null">
        #{fileShowname,jdbcType=VARCHAR},
      </if>
      <if test="filePath != null">
        #{filePath,jdbcType=VARCHAR},
      </if>
      <if test="fileRealname != null">
        #{fileRealname,jdbcType=VARCHAR},
      </if>
      <if test="fileSize != null">
        #{fileSize,jdbcType=VARCHAR},
      </if>
      <if test="fileSuffix != null">
        #{fileSuffix,jdbcType=VARCHAR},
      </if>
      <if test="cycle != null">
        #{cycle,jdbcType=BIGINT},
      </if>
      <if test="mechanism != null">
        #{mechanism,jdbcType=BIGINT},
      </if>
      <if test="cropId != null">
        #{cropId,jdbcType=INTEGER},
      </if>
      <if test="publishTime != null">
        #{publishTime,jdbcType=TIMESTAMP},
      </if>
      <if test="dataType != null">
        #{dataType,jdbcType=INTEGER},
      </if>
      <if test="approvalStatus != null">
        #{approvalStatus,jdbcType=INTEGER},
      </if>
      <if test="dsId != null">
        #{dsId,jdbcType=INTEGER},
      </if>
      <if test="reportTime != null">
        #{reportTime,jdbcType=DATE},
      </if>
      <if test="publishStatus != null">
        #{publishStatus,jdbcType=INTEGER},
      </if>
      <if test="publisherName != null">
        #{publisherName,jdbcType=VARCHAR},
      </if>
      <if test="resolution != null">
        #{resolution,jdbcType=INTEGER},
      </if>
      <if test="keyword != null">
        #{keyword,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  
  <select id="findDsReportByPage" resultMap="BaseResultMap" parameterType="com.jh.report.model.DsReportParam">
    select
        <include refid="Base_Column_List" />
    from ds_report
    where del_flag = '1' AND data_status='1'
    <if test="regionId!=null and regionId!=''">
      AND region_id = #{regionId,jdbcType=INTEGER}
    </if>
    <if test="cropId!=null and cropId!=''">
      AND crop_id = #{cropId,jdbcType=INTEGER}
    </if>
    <if test="dsId!=null and dsId!=''">
      AND ds_id = #{dsId,jdbcType=INTEGER}
    </if>
    <if test="startTimeReport != null and startTimeReport != '' and endTimeReport != null and endTimeReport != ''">
      AND to_char(to_date(cast(report_time as varchar),'yyyy-mm-dd'), 'yyyy-mm-dd') BETWEEN cast(#{startTimeReport} as VARCHAR) and cast(#{endTimeReport} as VARCHAR)
    </if>
    <if test="creatorName != null and creatorName != ''">
      AND creator_name like '%' || #{creatorName,jdbcType=VARCHAR} || '%'
    </if>
    <if test="approvalStatus!=null and approvalStatus!=''">
      AND approval_status = #{approvalStatus,jdbcType=INTEGER}
    </if>
    <if test="dataType!=null and dataType!=''">
      AND data_type = #{dataType,jdbcType=INTEGER}
    </if>
    <if test="resolution!=null and resolution!=''">
      AND resolution = #{resolution,jdbcType=INTEGER}
    </if>
    <if test="publishStatus!=null and publishStatus!=''">
      AND publish_status = #{publishStatus,jdbcType=INTEGER}
    </if>
    <if test="keyword!=null and keyword!=''">
      AND keyword LIKE '%' || #{keyword,jdbcType=VARCHAR} || '%'
    </if>
    <if test="startTimeCreate != null and startTimeCreate != '' and endTimeCreate != null and endTimeCreate != ''">
      AND create_time BETWEEN cast((#{startTimeCreate} || ' 00:00:00') as timestamp) and cast((#{endTimeCreate} || ' 23:59:59') as timestamp)
    </if>
    ORDER BY
    <choose>
      <when test="sidx != null and sidx != ''">
        ${sidx} ${sord}
      </when>
      <otherwise>
        publish_status DESC ,report_time DESC, create_time DESC
      </otherwise>
    </choose>
  </select>

  <select id="findDsReportById" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select
    <include refid="Base_Column_List" />
    from ds_report
    where report_id = #{reportId,jdbcType=INTEGER}
  </select>
  
  <update id="batchPublishReport">
    update ds_report
        set publish_time = #{dsReport.publishTime,jdbcType=TIMESTAMP},
            publish_status = #{dsReport.publishStatus,jdbcType=INTEGER},
            publisher_name = #{dsReport.publisherName,jdbcType=VARCHAR}
    where report_id in
    <foreach collection="rIds" index="index" item="item" separator="," open="(" close=")">
        #{item, jdbcType=INTEGER}
    </foreach>
  </update>

  <update id="updateReportInfo" parameterType="com.jh.report.entity.DsReport">
    update ds_report
    set
    modify_time = #{modifyTime,jdbcType=TIMESTAMP},
    modifier_name = #{modifierName,jdbcType=VARCHAR},
    modifier = #{modifier,jdbcType=INTEGER},
    report_name = #{reportName,jdbcType=VARCHAR},
    file_path = #{filePath,jdbcType=VARCHAR},
    file_size = #{fileSize,jdbcType=VARCHAR},
    file_suffix = #{fileSuffix,jdbcType=VARCHAR},
    approval_status = #{approvalStatus,jdbcType=INTEGER},
    report_time = #{reportTime,jdbcType=DATE},
    keyword = #{keyword,jdbcType=VARCHAR}
    where report_id = #{reportId,jdbcType=INTEGER}
  </update>

  <update id="batchCancelReport">
    update ds_report
    set publish_time = #{dsReport.publishTime,jdbcType=TIMESTAMP},
    publish_status = #{dsReport.publishStatus,jdbcType=INTEGER},
    publisher_name = #{dsReport.publisherName,jdbcType=VARCHAR}
    where report_id in
    <foreach collection="rIds" index="index" item="item" separator="," open="(" close=")">
      #{item, jdbcType=INTEGER}
    </foreach>
  </update>

  <update id="batchDeleteReport">
    update ds_report
    set del_flag = #{dsReport.delFlag,jdbcType=INTEGER}
    where report_id in
    <foreach collection="rIds" index="index" item="item" separator="," open="(" close=")">
      #{item, jdbcType=INTEGER}
    </foreach>
  </update>

  <select id="checkReportIsExist" resultMap="BaseResultMap" parameterType="com.jh.data.model.ReportCreateParam">
    SELECT
      <include refid="Base_Column_List" />
    FROM
        ds_report
    WHERE
        data_status = '1'
        AND del_flag = '1'
        AND ds_id = #{dataSet,jdbcType=INTEGER}
        AND region_id = #{regionId,jdbcType=INTEGER}
        <if test="cropId!=null and cropId!=''">
          AND crop_id = #{cropId,jdbcType=INTEGER}
        </if>
        AND resolution = #{resolution,jdbcType=INTEGER}
        AND report_time = to_date(cast(#{dataTime} as varchar),'yyyy-mm-dd')
  </select>





  <select id="findReportPageByParam" resultType="HashMap" parameterType="HashMap">
    SELECT report_id AS "reportId",report_name AS "reportName",file_showname AS "fileShowname",file_path AS "filePath",file_realname AS "fileRealname",
    file_size AS "fileSize",file_suffix,cycle,mechanism,crop_id,publish_time AS "publishTime",data_type AS "dataType",ds_id AS "dsId",
    approval_status,data_status,create_time,creator_name,creator,modify_time,modifier_name,modifier,remark,report_time FROM ds_report
    <where>
      <if test="publishStatus != null">
        publish_status = #{publishStatus}
      </if>
      <if test="dataStatus != null">
        AND data_status = #{dataStatus}
      </if>
      <if test="delFlag != null">
        AND del_flag=#{delFlag}
      </if>
      <if test="regionId != null">
        AND region_id = #{regionId}
      </if>
      <if test="dataSetId != null">
        AND ds_id = #{dataSetId}
      </if>
      <if test="reportProductList != null and reportProductList.size() > 0">
        <foreach collection="reportProductList" item="product" open=" AND (" close=")" separator="OR">
          (1 = 1
          <if test="product.accuracyId != null">
            AND resolution = #{product.accuracyId}
          </if>
          <if test="product.cropId != null">
            AND crop_id = #{product.cropId}
          </if>
          <if test="product.startDate != null and product.endDate != null">
            AND (report_time BETWEEN #{product.startDate} AND #{product.endDate})
          </if>)
        </foreach>
      </if>
    </where>
    ORDER BY report_time DESC
  </select>

  <select id="findReportPage" resultType="HashMap" parameterType="HashMap">
    SELECT report_id AS "reportId",report_name AS "reportName",file_showname AS "fileShowname",file_path AS "filePath",file_realname AS "fileRealname",
    file_size AS "fileSize",file_suffix,cycle,mechanism,crop_id,publish_time AS "publishTime",data_type AS "dataType",ds_id AS "dsId",
    approval_status,data_status,create_time,creator_name,creator,modify_time,modifier_name,modifier,remark,report_time FROM ds_report
    <where>
      <if test="publishStatus != null">
        publish_status = #{publishStatus}
      </if>
      <if test="dataStatus != null">
        AND data_status = #{dataStatus}
      </if>
      <if test="delFlag != null">
        AND del_flag=#{delFlag}
      </if>
      <if test="regionId != null">
        AND region_id = #{regionId}
      </if>
      <if test="dataSetId != null">
        AND ds_id = #{dataSetId}
      </if>
      <if test="cropId != null">
        AND crop_id = #{cropId}
      </if>
      <if test="accuracyId != null">
        AND resolution = #{accuracyId}
      </if>
      <if test="startDate != null and endDate != null">
        AND (report_time BETWEEN #{startDate} AND #{endDate})
      </if>
    </where>
    ORDER BY report_time DESC
  </select>


  <select id="findAllReport" resultType="HashMap" parameterType="HashMap">
    SELECT report_id AS "reportId",report_name AS "reportName",file_showname AS "fileShowname",file_path AS "filePath",file_realname AS "fileRealname",
    file_size AS "fileSize",file_suffix,cycle,mechanism,crop_id,publish_time AS "publishTime",data_type AS "dataType",ds_id AS "dsId",
    approval_status,data_status,create_time,creator_name,creator,modify_time,modifier_name,modifier,remark,report_time FROM ds_report
    <where>
      <if test="publishStatus != null">
        publish_status = #{publishStatus}
      </if>
      <if test="dataStatus != null">
        AND data_status = #{dataStatus}
      </if>
      <if test="delFlag != null">
        AND del_flag=#{delFlag}
      </if>
      <if test="regionId != null">
        AND region_id = #{regionId}
      </if>
      <if test="dataSetId != null">
        AND ds_id = #{dataSetId}
      </if>
      <if test="cropId != null">
        AND crop_id = #{cropId}
      </if>
      <if test="accuracyId != null">
        AND resolution = #{accuracyId}
      </if>
      <if test="startDate != null and endDate != null">
        AND (report_time BETWEEN #{startDate} AND #{endDate})
      </if>
    </where>
    ORDER BY report_time DESC
  </select>

  <sql id="Base_Column_Show_List" >
    report_id,
    data_status,
    del_flag,
    create_time,
    creator_name,
    creator,
    modify_time,
    modifier_name,
    modifier,
    remark,
    region_id,
    report_name,
    file_showname,
    file_path,
    file_realname,
    file_size,
    file_suffix,
    cycle,
    mechanism,
    crop_id,
    publish_time,
    data_type,
    approval_status,
    ds_id,
    report_time,
    publish_status,
    publisher_name,
    resolution,
    keyword
  </sql>

  <!--分页查询报告列表-->
  <select id="findReportShowByPage" resultType="map" parameterType="java.util.HashMap">
    SELECT
    report_id,report_name
    FROM
    ds_report
    WHERE
    del_flag='1'
    AND data_status='1'
    <if test="publishStatus != null and publishStatus != ''">
      AND publish_status = #{publishStatus,jdbcType=INTEGER}
    </if>
    <if test="regionList != null and regionList.size()>0">
      AND region_id in (
      <foreach item="item" index="index" collection="regionList" separator=",">
        #{item,jdbcType=BIGINT}
      </foreach>
      )
    </if>
    <if test="regionId != null and regionId != ''">
      AND region_id = #{regionId,jdbcType=BIGINT}
    </if>
    ORDER BY
    report_time DESC
  </select>

  <!--根据id查询报告详情-->
  <select id="findReportShowById" resultType="map" parameterType="Integer">
    SELECT
    <include refid="Base_Column_Show_List" />
    FROM
    ds_report
    WHERE
    del_flag='1'
    AND data_status='1'
    AND report_id = #{reportId,jdbcType=INTEGER}
  </select>



</mapper>